# ============================================================================
# Elizabeth Docker Environment Configuration
# ============================================================================
# Copy this file to .env and customize the values for your deployment
# All values shown here are defaults and can be overridden

# ----------------------------------------------------------------------------
# Port Configuration
# ----------------------------------------------------------------------------
BACKEND_PORT=4092
FRONTEND_PORT=4001

# ----------------------------------------------------------------------------
# Host Bind Mounts (optional)
# ----------------------------------------------------------------------------
# Override these if you want to store DB/files outside the repo directory.
# Examples:
#   ELIZABETH_DATA_DIR=/var/lib/elizabeth/data
#   ELIZABETH_STORAGE_DIR=/var/lib/elizabeth/storage
#   ELIZABETH_BACKEND_CONFIG=/etc/elizabeth/backend.yaml
ELIZABETH_DATA_DIR=./docker/backend/data
ELIZABETH_STORAGE_DIR=./docker/backend/storage
ELIZABETH_BACKEND_CONFIG=./docker/backend/config/backend.yaml

# ----------------------------------------------------------------------------
# Frontend Configuration
# ----------------------------------------------------------------------------
# API path exposed to the browser. Keep it relative so every request stays on the same HTTPS origin.
# Using /api/v1 works for both local Docker and production deployments.
NEXT_PUBLIC_API_URL=/api/v1

# Internal API origin consumed by the Next.js server. Reachable only inside the container network.
# Docker default: http://elizabeth-backend:4092/api/v1
INTERNAL_API_URL=http://elizabeth-backend:4092/api/v1

# App URL - The public URL where the frontend is hosted
# For local Docker: http://localhost:4001
# For production: https://yourdomain.com
NEXT_PUBLIC_APP_URL=http://localhost:4001

# ----------------------------------------------------------------------------
# Database Configuration
# ----------------------------------------------------------------------------
DB_MAX_CONNECTIONS=20
DB_MIN_CONNECTIONS=5

# ----------------------------------------------------------------------------
# JWT Configuration
# ----------------------------------------------------------------------------
# IMPORTANT: Change this in production! Must be at least 32 characters
JWT_SECRET=please-change-this-secret-in-production-min-32-chars-long-for-security # pragma: allowlist secret

# JWT token time-to-live in seconds (default: 2 hours)
JWT_TTL_SECONDS=7200

# JWT leeway in seconds for clock skew (default: 5 seconds)
JWT_LEEWAY_SECONDS=5

# Refresh token time-to-live in seconds (default: 7 days)
JWT_REFRESH_TTL_SECONDS=604800

# Maximum number of times a refresh token can be used
JWT_MAX_REFRESH_COUNT=10

# Cleanup interval for expired tokens in seconds (default: 24 hours)
JWT_CLEANUP_INTERVAL_SECONDS=86400

# Enable refresh token rotation for enhanced security
JWT_ENABLE_REFRESH_TOKEN_ROTATION=true

# ----------------------------------------------------------------------------
# Room Configuration
# ----------------------------------------------------------------------------
# Maximum room content size in bytes (default: 50MB)
ROOM_MAX_SIZE=52428800

# Maximum number of times a room can be entered
ROOM_MAX_TIMES_ENTERED=100

# ----------------------------------------------------------------------------
# Upload Configuration
# ----------------------------------------------------------------------------
# Upload reservation time-to-live in seconds (default: 1 hour)
UPLOAD_RESERVATION_TTL_SECONDS=3600

# ----------------------------------------------------------------------------
# Logging Configuration
# ----------------------------------------------------------------------------
# Log level: off, error, warn, info, debug, trace
LOG_LEVEL=info

# ----------------------------------------------------------------------------
# Middleware Configuration
# ----------------------------------------------------------------------------

# Tracing Middleware
MIDDLEWARE_TRACING_ENABLED=true
MIDDLEWARE_TRACING_LEVEL=info
MIDDLEWARE_TRACING_INCLUDE_HEADERS=false
MIDDLEWARE_TRACING_INCLUDE_BODY=false

# Request ID Middleware
MIDDLEWARE_REQUEST_ID_ENABLED=true
MIDDLEWARE_REQUEST_ID_HEADER_NAME=X-Request-Id
MIDDLEWARE_REQUEST_ID_GENERATE_IF_MISSING=true

# Compression Middleware
MIDDLEWARE_COMPRESSION_ENABLED=true
MIDDLEWARE_COMPRESSION_MIN_CONTENT_LENGTH=1024

# CORS Middleware
MIDDLEWARE_CORS_ENABLED=true
# For production, specify exact origins instead of *
MIDDLEWARE_CORS_ALLOWED_ORIGINS=*
MIDDLEWARE_CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
MIDDLEWARE_CORS_ALLOWED_HEADERS=*
MIDDLEWARE_CORS_ALLOW_CREDENTIALS=false
MIDDLEWARE_CORS_MAX_AGE=3600

# Security Middleware
MIDDLEWARE_SECURITY_ENABLED=true
MIDDLEWARE_SECURITY_CONTENT_TYPE_OPTIONS=true
MIDDLEWARE_SECURITY_FRAME_OPTIONS=DENY
MIDDLEWARE_SECURITY_XSS_PROTECTION=1; mode=block
MIDDLEWARE_SECURITY_STRICT_TRANSPORT_SECURITY=max-age=31536000; includeSubDomains
MIDDLEWARE_SECURITY_REFERRER_POLICY=strict-origin-when-cross-origin

# Rate Limit Middleware
MIDDLEWARE_RATE_LIMIT_ENABLED=true
MIDDLEWARE_RATE_LIMIT_PER_SECOND=20
MIDDLEWARE_RATE_LIMIT_BURST_SIZE=40
MIDDLEWARE_RATE_LIMIT_CLEANUP_INTERVAL_SECONDS=60
