# Elizabeth é¡¹ç›®å‰ç«¯æ¶æ„æ€»è§ˆæ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0 **åˆ›å»ºæ—¥æœŸ**ï¼š2025-10-31
> **åŸºäºåˆ†æ**ï¼šå‰ç«¯ç»„ä»¶åˆ†æã€çŠ¶æ€ç®¡ç†åˆ†æã€é¡¹ç›®è¿›åº¦æ–‡æ¡£ã€é›†æˆæ€»ç»“æŠ¥å‘Š
> **æ–‡æ¡£ç›®æ ‡**ï¼šä¸º Elizabeth é¡¹ç›®æä¾›å…¨é¢çš„å‰ç«¯æ¶æ„æŠ€æœ¯æ–‡æ¡£

## ğŸ“‹ ç›®å½•

- [1. é¡¹ç›®æ¦‚è§ˆ](#1-é¡¹ç›®æ¦‚è§ˆ)
  - [1.1 é¡¹ç›®ç®€ä»‹å’Œç›®æ ‡](#11-é¡¹ç›®ç®€ä»‹å’Œç›®æ ‡)
  - [1.2 æŠ€æœ¯æ ˆæ€»è§ˆ](#12-æŠ€æœ¯æ ˆæ€»è§ˆ)
  - [1.3 æ¶æ„è®¾è®¡ç†å¿µ](#13-æ¶æ„è®¾è®¡ç†å¿µ)
  - [1.4 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—](#14-æ ¸å¿ƒåŠŸèƒ½æ¨¡å—)

- [2. æ¶æ„æ€»è§ˆ](#2-æ¶æ„æ€»è§ˆ)
  - [2.1 æ•´ä½“æ¶æ„å›¾ï¼ˆæ–‡å­—æè¿°ï¼‰](#21-æ•´ä½“æ¶æ„å›¾æ–‡å­—æè¿°)
  - [2.2 å„å±‚çº§çš„èŒè´£åˆ†å·¥](#22-å„å±‚çº§çš„èŒè´£åˆ†å·¥)
  - [2.3 æ¨¡å—é—´çš„ä¾èµ–å…³ç³»](#23-æ¨¡å—é—´çš„ä¾èµ–å…³ç³»)
  - [2.4 æ•°æ®æµå‘å’Œé€šä¿¡æœºåˆ¶](#24-æ•°æ®æµå‘å’Œé€šä¿¡æœºåˆ¶)

- [3. æ ¸å¿ƒæŠ€æœ¯æ ˆ](#3-æ ¸å¿ƒæŠ€æœ¯æ ˆ)
  - [3.1 å‰ç«¯æŠ€æœ¯æ ˆè¯¦æƒ…](#31-å‰ç«¯æŠ€æœ¯æ ˆè¯¦æƒ…)
  - [3.2 åç«¯æŠ€æœ¯æ ˆè¯¦æƒ…](#32-åç«¯æŠ€æœ¯æ ˆè¯¦æƒ…)
  - [3.3 å¼€å‘å·¥å…·å’Œé…ç½®](#33-å¼€å‘å·¥å…·å’Œé…ç½®)
  - [3.4 ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶](#34-ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶)

- [4. æ¨¡å—è¯¦ç»†è¯´æ˜](#4-æ¨¡å—è¯¦ç»†è¯´æ˜)
  - [4.1 èŠå¤©ç»„ä»¶æ¨¡å—](#41-èŠå¤©ç»„ä»¶æ¨¡å—)
  - [4.2 æ–‡ä»¶ç®¡ç†ç»„ä»¶æ¨¡å—](#42-æ–‡ä»¶ç®¡ç†ç»„ä»¶æ¨¡å—)
  - [4.3 å¸ƒå±€ç»„ä»¶æ¨¡å—](#43-å¸ƒå±€ç»„ä»¶æ¨¡å—)
  - [4.4 æˆ¿é—´ç®¡ç†ç»„ä»¶æ¨¡å—](#44-æˆ¿é—´ç®¡ç†ç»„ä»¶æ¨¡å—)
  - [4.5 çŠ¶æ€ç®¡ç†æ¨¡å—](#45-çŠ¶æ€ç®¡ç†æ¨¡å—)
  - [4.6 API æœåŠ¡å±‚æ¨¡å—](#46-apiæœåŠ¡å±‚æ¨¡å—)

- [5. å¼€å‘æµç¨‹å’Œå·¥ä½œæµ](#5-å¼€å‘æµç¨‹å’Œå·¥ä½œæµ)
  - [5.1 å…¸å‹çš„å¼€å‘å·¥ä½œæµ](#51-å…¸å‹çš„å¼€å‘å·¥ä½œæµ)
  - [5.2 ä»£ç ç»„ç»‡å’Œæ„å»ºæµç¨‹](#52-ä»£ç ç»„ç»‡å’Œæ„å»ºæµç¨‹)
  - [5.3 æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹](#53-æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹)
  - [5.4 æ–‡æ¡£å’Œç»´æŠ¤æµç¨‹](#54-æ–‡æ¡£å’Œç»´æŠ¤æµç¨‹)

- [6. æ¶æ„ä¼˜åŠ¿å’Œç‰¹ç‚¹](#6-æ¶æ„ä¼˜åŠ¿å’Œç‰¹ç‚¹)
  - [6.1 æ¶æ„çš„ä¸»è¦ä¼˜åŠ¿](#61-æ¶æ„çš„ä¸»è¦ä¼˜åŠ¿)
  - [6.2 æŠ€æœ¯é€‰å‹çš„ç†ç”±](#62-æŠ€æœ¯é€‰å‹çš„ç†ç”±)
  - [6.3 å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§](#63-å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§)
  - [6.4 æ€§èƒ½å’Œå®‰å…¨æ€§](#64-æ€§èƒ½å’Œå®‰å…¨æ€§)

- [7. æ”¹è¿›å»ºè®®å’Œå‘å±•æ–¹å‘](#7-æ”¹è¿›å»ºè®®å’Œå‘å±•æ–¹å‘)
  - [7.1 çŸ­æœŸæ”¹è¿›å»ºè®®](#71-çŸ­æœŸæ”¹è¿›å»ºè®®)
  - [7.2 é•¿æœŸå‘å±•è§„åˆ’](#72-é•¿æœŸå‘å±•è§„åˆ’)
  - [7.3 æŠ€æœ¯å€ºåŠ¡å’Œé‡æ„è®¡åˆ’](#73-æŠ€æœ¯å€ºåŠ¡å’Œé‡æ„è®¡åˆ’)
  - [7.4 å›¢é˜Ÿåä½œå’ŒçŸ¥è¯†ç®¡ç†](#74-å›¢é˜Ÿåä½œå’ŒçŸ¥è¯†ç®¡ç†)

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 é¡¹ç›®ç®€ä»‹å’Œç›®æ ‡

Elizabeth
æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„æ–‡ä»¶åˆ†äº«ä¸åä½œå¹³å°ï¼Œé‡‡ç”¨"ä»¥æˆ¿é—´ä¸ºä¸­å¿ƒ"çš„è®¾è®¡ç†å¿µï¼Œæ”¯æŒå®æ—¶åä½œã€æ–‡ä»¶ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚é¡¹ç›®æ—¨åœ¨ä¸ºç”¨æˆ·æä¾›å®‰å…¨ã€é«˜æ•ˆã€æ˜“ç”¨çš„æ–‡ä»¶å…±äº«ä½“éªŒã€‚

**é¡¹ç›®ç›®æ ‡**ï¼š

- æä¾›å®‰å…¨å¯é çš„æ–‡ä»¶å­˜å‚¨å’Œåˆ†äº«æœåŠ¡
- æ”¯æŒå¤šç”¨æˆ·å®æ—¶åä½œ
- å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ç³»ç»Ÿ
- æä¾›ä¼˜ç§€çš„ç”¨æˆ·ä½“éªŒå’Œç•Œé¢è®¾è®¡
- ç¡®ä¿æ•°æ®å®‰å…¨å’Œéšç§ä¿æŠ¤

### 1.2 æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚çº§      | æŠ€æœ¯é€‰å‹              | ä¸»è¦ç”¨é€”              |
| --------- | --------------------- | --------------------- |
| å‰ç«¯æ¡†æ¶  | Next.js 14 + React 18 | ç°ä»£åŒ– React åº”ç”¨æ¡†æ¶ |
| çŠ¶æ€ç®¡ç†  | Zustand + TypeScript  | è½»é‡çº§çŠ¶æ€ç®¡ç†        |
| æ ·å¼æ¡†æ¶  | Tailwind CSS          | å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶   |
| UI ç»„ä»¶åº“ | shadcn/ui + Radix UI  | é«˜è´¨é‡ç»„ä»¶åº“          |
| åç«¯æ¡†æ¶  | Rust + Axum           | é«˜æ€§èƒ½ Web æ¡†æ¶       |
| æ•°æ®åº“    | SQLite + SQLx         | è½»é‡çº§æ•°æ®åº“è§£å†³æ–¹æ¡ˆ  |
| è®¤è¯ç³»ç»Ÿ  | JWT + ä½æƒé™          | å®‰å…¨çš„æƒé™æ§åˆ¶        |

### 1.3 æ¶æ„è®¾è®¡ç†å¿µ

Elizabeth é¡¹ç›®éµå¾ªä»¥ä¸‹æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š

**æ¨¡å—åŒ–è®¾è®¡**ï¼š

- é«˜å†…èšä½è€¦åˆçš„ç»„ä»¶æ¶æ„
- æ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œæ¥å£å®šä¹‰
- å¯å¤ç”¨çš„é€šç”¨ç»„ä»¶è®¾è®¡

**çŠ¶æ€é©±åŠ¨**ï¼š

- å•å‘æ•°æ®æµè®¾è®¡
- é›†ä¸­å¼çŠ¶æ€ç®¡ç†
- ä¹è§‚æ›´æ–°æœºåˆ¶

**ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**ï¼š

- å“åº”å¼è®¾è®¡ï¼Œç§»åŠ¨ç«¯ä¼˜å…ˆ
- æ— éšœç¢è®¿é—®æ”¯æŒ
- å®æ—¶åé¦ˆå’ŒåŠ è½½çŠ¶æ€

**å®‰å…¨ç¬¬ä¸€**ï¼š

- JWT è®¤è¯æœºåˆ¶
- ç»†ç²’åº¦æƒé™æ§åˆ¶
- æ•°æ®ä¼ è¾“åŠ å¯†

### 1.4 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

1. **æˆ¿é—´ç®¡ç†ç³»ç»Ÿ**ï¼šåˆ›å»ºã€é…ç½®ã€æƒé™æ§åˆ¶ã€åˆ†äº«åŠŸèƒ½
2. **æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ**ï¼šä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆã€æ‰¹é‡æ“ä½œ
3. **å®æ—¶åä½œç³»ç»Ÿ**ï¼šæ¶ˆæ¯ä¼ é€’ã€çŠ¶æ€åŒæ­¥ã€å¤šç”¨æˆ·æ”¯æŒ
4. **æƒé™æ§åˆ¶ç³»ç»Ÿ**ï¼šåŸºäºä½æ ‡å¿—çš„æƒé™ç®¡ç†
5. **ç”¨æˆ·ç•Œé¢ç³»ç»Ÿ**ï¼šå“åº”å¼å¸ƒå±€ã€ä¸»é¢˜åˆ‡æ¢ã€è®¾ç½®ç®¡ç†

---

## 2. æ¶æ„æ€»è§ˆ

### 2.1 æ•´ä½“æ¶æ„å›¾ï¼ˆæ–‡å­—æè¿°ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç”¨æˆ·ç•Œé¢å±‚ (Presentation Layer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚              Reactç»„ä»¶å±‚                    â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚ èŠå¤©ç»„ä»¶   â”‚ æ–‡ä»¶ç»„ä»¶    â”‚     â”‚
â”‚  â”‚  â”‚ MessageList  â”‚ FileCard     â”‚     â”‚
â”‚  â”‚  â”‚ MessageInput â”‚ FileUpload   â”‚     â”‚
â”‚  â”‚  â”‚ MarkdownEditorâ”‚ FilePreview  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚  â”‚              å¸ƒå±€ç»„ä»¶                      â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚ å·¦ä¾§è¾¹æ    â”‚ å³ä¾§è¾¹æ     â”‚     â”‚
â”‚  â”‚  â”‚ RoomSettingsâ”‚ FileList     â”‚     â”‚
â”‚  â”‚  â”‚ TopBar     â”‚ MiddleColumn  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚  â”‚              æˆ¿é—´ç®¡ç†ç»„ä»¶                  â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚ æƒé™ç®¡ç†   â”‚ åˆ†äº«åŠŸèƒ½    â”‚     â”‚
â”‚  â”‚  â”‚ RoomPerms   â”‚ RoomShare    â”‚     â”‚
â”‚  â”‚  â”‚ RoomSettings â”‚ RoomCapacity  â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚  â”‚              å…¨å±€ç»„ä»¶                      â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚ ä¸»é¢˜æä¾›è€…  â”‚ è®¾ç½®å¯¹è¯æ¡†    â”‚     â”‚
â”‚  â”‚  â”‚ ThemeProviderâ”‚ SettingsDialogâ”‚     â”‚
â”‚  â”‚  â”‚ FontSizeMgr â”‚ HelpDialog    â”‚     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                    â†“                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚              â”‚        çŠ¶æ€ç®¡ç†å±‚ (State Layer)        â”‚     â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚              â”‚  â”‚  Zustand Store â”‚ è‡ªå®šä¹‰Hooks â”‚     â”‚
â”‚              â”‚  â”‚ å…¨å±€çŠ¶æ€    â”‚ æƒé™æ£€æŸ¥   â”‚     â”‚
â”‚              â”‚  â”‚ ä¸»é¢˜ç®¡ç†    â”‚ ç§»åŠ¨ç«¯æ£€æµ‹ â”‚     â”‚
â”‚              â”‚  â”‚ æ¶ˆæ¯çŠ¶æ€    â”‚ Toasté€šçŸ¥   â”‚     â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                    â†“                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚              â”‚       æœåŠ¡å±‚ (Service Layer)            â”‚     â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚              â”‚  â”‚ è®¤è¯æœåŠ¡   â”‚ æ¶ˆæ¯æœåŠ¡    â”‚     â”‚
â”‚              â”‚  â”‚ authService â”‚ messageServiceâ”‚     â”‚
â”‚              â”‚  â”‚ æˆ¿é—´æœåŠ¡   â”‚ æ–‡ä»¶æœåŠ¡    â”‚     â”‚
â”‚              â”‚  â”‚ roomService â”‚ fileService  â”‚     â”‚
â”‚              â”‚  â”‚ åˆ†äº«æœåŠ¡   â”‚ æƒé™æœåŠ¡    â”‚     â”‚
â”‚              â”‚  â”‚ shareService â”‚ permService  â”‚     â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                    â†“                                    â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚              â”‚        åç«¯APIå±‚ (Backend API)           â”‚     â”‚
â”‚              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚              â”‚  â”‚ è®¤è¯ç«¯ç‚¹   â”‚ æˆ¿é—´ç«¯ç‚¹    â”‚     â”‚
â”‚              â”‚  â”‚ /auth       â”‚ /rooms      â”‚     â”‚
â”‚              â”‚  â”‚ æ¶ˆæ¯ç«¯ç‚¹   â”‚ æ–‡ä»¶ç«¯ç‚¹    â”‚     â”‚
â”‚              â”‚  â”‚ /messages   â”‚ /files      â”‚     â”‚
â”‚              â”‚  â”‚ æƒé™ç«¯ç‚¹   â”‚ åˆ†äº«ç«¯ç‚¹    â”‚     â”‚
â”‚              â”‚  â”‚ /permissions â”‚ /share      â”‚     â”‚
â”‚              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚     â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 å„å±‚çº§çš„èŒè´£åˆ†å·¥

#### ç”¨æˆ·ç•Œé¢å±‚ (Presentation Layer)

**èŒè´£**ï¼šç”¨æˆ·äº¤äº’å’Œç•Œé¢å±•ç¤º

- **React ç»„ä»¶**ï¼šå®ç°ç”¨æˆ·ç•Œé¢å’Œäº¤äº’é€»è¾‘
- **å“åº”å¼å¸ƒå±€**ï¼šé€‚é…ä¸åŒè®¾å¤‡å’Œå±å¹•å°ºå¯¸
- **ä¸»é¢˜ç³»ç»Ÿ**ï¼šæ”¯æŒäº®è‰²/æš—è‰²/ç³»ç»Ÿä¸»é¢˜
- **ç”¨æˆ·ä½“éªŒ**ï¼šåŠ è½½çŠ¶æ€ã€é”™è¯¯å¤„ç†ã€æ— éšœç¢è®¿é—®

#### çŠ¶æ€ç®¡ç†å±‚ (State Layer)

**èŒè´£**ï¼šåº”ç”¨çŠ¶æ€ç®¡ç†å’Œæ•°æ®æµæ§åˆ¶

- **Zustand Store**ï¼šé›†ä¸­å¼çŠ¶æ€å­˜å‚¨å’Œæ›´æ–°
- **è‡ªå®šä¹‰ Hooks**ï¼šå°è£…å¤æ‚çŠ¶æ€é€»è¾‘å’Œå‰¯ä½œç”¨
- **æŒä¹…åŒ–**ï¼šç”¨æˆ·åå¥½è®¾ç½®çš„æœ¬åœ°å­˜å‚¨

#### æœåŠ¡å±‚ (Service Layer)

**èŒè´£**ï¼šAPI è°ƒç”¨å’Œæ•°æ®å¤„ç†

- **HTTP å®¢æˆ·ç«¯**ï¼šç»Ÿä¸€çš„è¯·æ±‚å°è£…å’Œé”™è¯¯å¤„ç†
- **æ•°æ®è½¬æ¢**ï¼šå‰åç«¯æ•°æ®æ ¼å¼è½¬æ¢
- **ç¼“å­˜ç®¡ç†**ï¼šReact Query è¿›è¡Œæ•°æ®ç¼“å­˜å’ŒåŒæ­¥

#### åç«¯ API å±‚ (Backend API)

**èŒè´£**ï¼šä¸šåŠ¡é€»è¾‘å’Œæ•°æ®æŒä¹…åŒ–

- **RESTful æ¥å£**ï¼šæ ‡å‡†åŒ–çš„ HTTP API è®¾è®¡
- **JWT è®¤è¯**ï¼šå®‰å…¨çš„ç”¨æˆ·è®¤è¯å’Œæƒé™æ§åˆ¶
- **æ•°æ®å­˜å‚¨**ï¼šSQLite æ•°æ®åº“å’Œ SQLx æŸ¥è¯¢

### 2.3 æ¨¡å—é—´çš„ä¾èµ–å…³ç³»

```
èŠå¤©ç»„ä»¶ â† çŠ¶æ€ç®¡ç† â† APIæœåŠ¡ â† åç«¯API
    â†“           â†“         â†“
æ–‡ä»¶ç»„ä»¶ â† çŠ¶æ€ç®¡ç† â† APIæœåŠ¡ â† åç«¯API
    â†“           â†“         â†“
å¸ƒå±€ç»„ä»¶ â† çŠ¶æ€ç®¡ç† â† APIæœåŠ¡ â† åç«¯API
    â†“           â†“         â†“
æˆ¿é—´ç»„ä»¶ â† çŠ¶æ€ç®¡ç† â† APIæœåŠ¡ â† åç«¯API
```

### 2.4 æ•°æ®æµå‘å’Œé€šä¿¡æœºåˆ¶

#### æ•°æ®æµå‘

1. **ç”¨æˆ·æ“ä½œ** â†’ **ç»„ä»¶äº‹ä»¶** â†’ **çŠ¶æ€æ›´æ–°** â†’ **API è°ƒç”¨** â†’ **æœåŠ¡å™¨å“åº”** â†’
   **å…¨å±€çŠ¶æ€åŒæ­¥** â†’ **UI é‡æ–°æ¸²æŸ“**

#### é€šä¿¡æœºåˆ¶

- **äº‹ä»¶é©±åŠ¨**ï¼šç”¨æˆ·æ“ä½œè§¦å‘ç»„ä»¶äº‹ä»¶
- **å›è°ƒæ¨¡å¼**ï¼šçˆ¶å­ç»„ä»¶é€šè¿‡ props ä¼ é€’å›è°ƒ
- **å‘å¸ƒè®¢é˜…**ï¼šç»„ä»¶è®¢é˜…å…¨å±€çŠ¶æ€å˜åŒ–
- **å¼‚æ­¥å¤„ç†**ï¼šAPI è°ƒç”¨å’ŒçŠ¶æ€æ›´æ–°çš„å¼‚æ­¥åè°ƒ

---

## 3. æ ¸å¿ƒæŠ€æœ¯æ ˆ

### 3.1 å‰ç«¯æŠ€æœ¯æ ˆè¯¦æƒ…

#### æ ¸å¿ƒæ¡†æ¶

- **Next.js 14**ï¼šReact å…¨æ ˆæ¡†æ¶ï¼Œæ”¯æŒ App Routerã€æœåŠ¡å™¨ç»„ä»¶ã€é™æ€ä¼˜åŒ–
- **React 18**ï¼šç°ä»£ React ç‰¹æ€§ï¼ŒHooksã€å¹¶å‘ç‰¹æ€§ã€Suspense
- **TypeScript**ï¼šå®Œæ•´çš„ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥

#### çŠ¶æ€ç®¡ç†

- **Zustand**ï¼šè½»é‡çº§çŠ¶æ€ç®¡ç†åº“ï¼Œç®€æ´çš„ API è®¾è®¡
- **React Query**ï¼šå¼ºå¤§çš„æ•°æ®è·å–å’Œç¼“å­˜ç®¡ç†
- **React Context**ï¼šå…¨å±€çŠ¶æ€ä¼ é€’å’Œä¸»é¢˜ç®¡ç†

#### æ ·å¼å’Œ UI

- **Tailwind CSS**ï¼šå®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶ï¼Œå“åº”å¼è®¾è®¡
- **shadcn/ui**ï¼šé«˜è´¨é‡çš„ React ç»„ä»¶åº“ï¼ŒåŸºäº Radix UI
- **Headless UI**ï¼šæ— æ ·å¼ç»„ä»¶åº“ï¼Œé«˜åº¦å¯å®šåˆ¶

#### å¼€å‘å·¥å…·

- **ESLint + Prettier**ï¼šä»£ç è´¨é‡å’Œæ ¼å¼åŒ–
- **Playwright**ï¼šç«¯åˆ°ç«¯æµ‹è¯•æ¡†æ¶
- **pnpm**ï¼šåŒ…ç®¡ç†å™¨ï¼Œæ€§èƒ½ä¼˜åŒ–

### 3.2 åç«¯æŠ€æœ¯æ ˆè¯¦æƒ…

#### Web æ¡†æ¶

- **Axum**ï¼šç°ä»£å¼‚æ­¥ Web æ¡†æ¶ï¼ŒåŸºäº Rust
- **Tower**ï¼šä¸­é—´ä»¶æ ˆï¼Œè®¤è¯ã€é™æµã€æ—¥å¿—
- **SQLx**ï¼šç±»å‹å®‰å…¨çš„æ•°æ®åº“æŸ¥è¯¢åº“

#### æ•°æ®åº“

- **SQLite**ï¼šè½»é‡çº§å…³ç³»æ•°æ®åº“ï¼Œå¼€å‘é˜¶æ®µå‹å¥½
- **æ•°æ®åº“è¿ç§»**ï¼šç‰ˆæœ¬åŒ–çš„æ•°æ®åº“ç»“æ„ç®¡ç†

#### è®¤è¯å’Œå®‰å…¨

- **JWT**ï¼šJSON Web Token è®¤è¯æœºåˆ¶
- **bcrypt**ï¼šå¯†ç å“ˆå¸Œå’ŒéªŒè¯
- **æƒé™ç³»ç»Ÿ**ï¼šåŸºäºä½æ ‡å¿—çš„ç»†ç²’åº¦æƒé™æ§åˆ¶

### 3.3 å¼€å‘å·¥å…·å’Œé…ç½®

#### æ„å»ºå·¥å…·

- **Cargo**ï¼šRust åŒ…ç®¡ç†å™¨å’Œæ„å»ºå·¥å…·
- **Next.js æ„å»º**ï¼šä¼˜åŒ–çš„ç”Ÿäº§æ„å»º
- **ä»£ç åˆ†å‰²**ï¼šè‡ªåŠ¨çš„ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

#### å¼€å‘ç¯å¢ƒ

- **çƒ­é‡è½½**ï¼šå¼€å‘æ—¶çš„å¿«é€Ÿåé¦ˆ
- **ç±»å‹æ£€æŸ¥**ï¼šå®æ—¶çš„ TypeScript é”™è¯¯æ£€æŸ¥
- **ä»£ç æ ¼å¼åŒ–**ï¼šç»Ÿä¸€çš„ä»£ç é£æ ¼

### 3.4 ç¬¬ä¸‰æ–¹åº“å’Œæ¡†æ¶

#### å‰ç«¯åº“

```typescript
// UI ç»„ä»¶åº“
import { Button } from "@/components/ui/button";
import { Dialog } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";

// çŠ¶æ€ç®¡ç†
import { create } from "zustand";
import { useQuery } from "@tanstack/react-query";

// å·¥å…·åº“
import { clsx } from "clsx";
import { toast } from "sonner";
```

#### åç«¯åº“

```rust
// Web æ¡†æ¶
use axum::{
    routing::Router,
    extract::Request,
    middleware::from_fn,
    Json,
};

// æ•°æ®åº“
use sqlx::FromRow;

// è®¤è¯
use jsonwebtoken::{decode, encode, Header};
```

---

## 4. æ¨¡å—è¯¦ç»†è¯´æ˜

### 4.1 èŠå¤©ç»„ä»¶æ¨¡å—

#### æ¨¡å—åŠŸèƒ½æ¦‚è¿°

èŠå¤©æ¨¡å—è´Ÿè´£å®æ—¶æ¶ˆæ¯ä¼ é€’å’Œåä½œåŠŸèƒ½ï¼ŒåŒ…æ‹¬æ¶ˆæ¯æ˜¾ç¤ºã€ç¼–è¾‘ã€å‘é€ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

#### æ ¸å¿ƒç»„ä»¶

- **MessageList**ï¼šæ¶ˆæ¯åˆ—è¡¨æ˜¾ç¤ºï¼Œæ”¯æŒæ‰¹é‡æ“ä½œ
- **MessageInput**ï¼šæ¶ˆæ¯è¾“å…¥å’Œç¼–è¾‘ï¼Œæ”¯æŒ Markdown
- **MessageBubble**ï¼šå•æ¡æ¶ˆæ¯æ˜¾ç¤ºï¼Œæ”¯æŒæ“ä½œèœå•
- **MarkdownRenderer**ï¼šMarkdown å†…å®¹æ¸²æŸ“ï¼Œæ”¯æŒä»£ç é«˜äº®
- **EnhancedMarkdownEditor**ï¼šå¢å¼ºçš„ç¼–è¾‘å™¨ï¼Œæ”¯æŒé¢„è§ˆ

#### æ¥å£å®šä¹‰

```typescript
interface MessageProps {
  message: LocalMessage;
  isSelected: boolean;
  onSelect: (id: string) => void;
  onEdit: (id: string, content: string) => void;
  onDelete: (id: string) => void;
}

interface ChatState {
  messages: LocalMessage[];
  selectedMessages: Set<string>;
  addMessage: (content: string) => void;
  updateMessage: (id: string, content: string) => void;
}
```

#### è®¾è®¡æ¨¡å¼

- **å®¹å™¨ç»„ä»¶æ¨¡å¼**ï¼šMessageList ä½œä¸ºå®¹å™¨ï¼Œç®¡ç†å­ç»„ä»¶çŠ¶æ€
- **æ¸²æŸ“ä¼˜åŒ–**ï¼šè™šæ‹Ÿæ»šåŠ¨ï¼Œæ‡’åŠ è½½
- **çŠ¶æ€æå‡**ï¼šå¤æ‚çŠ¶æ€æå‡åˆ°çˆ¶ç»„ä»¶æˆ–å…¨å±€çŠ¶æ€

### 4.2 æ–‡ä»¶ç®¡ç†ç»„ä»¶æ¨¡å—

#### æ¨¡å—åŠŸèƒ½æ¦‚è¿°

æ–‡ä»¶ç®¡ç†æ¨¡å—è´Ÿè´£æ–‡ä»¶çš„ä¸Šä¼ ã€ä¸‹è½½ã€é¢„è§ˆå’Œç®¡ç†åŠŸèƒ½ã€‚

#### æ ¸å¿ƒç»„ä»¶

- **FileCard**ï¼šæ–‡ä»¶ä¿¡æ¯æ˜¾ç¤ºå’ŒåŸºæœ¬æ“ä½œ
- **FileListView**ï¼šæ–‡ä»¶åˆ—è¡¨å±•ç¤ºï¼Œæ”¯æŒæ‰¹é‡é€‰æ‹©
- **FileUploadZone**ï¼šæ‹–æ‹½ä¸Šä¼ ï¼Œæ”¯æŒè¿›åº¦æ˜¾ç¤º
- **FilePreviewModal**ï¼šå¤šåª’ä½“æ–‡ä»¶é¢„è§ˆï¼Œæ”¯æŒå¤šç§æ ¼å¼

#### æ¥å£å®šä¹‰

```typescript
interface FileComponentProps {
  file: FileInfo;
  isSelected: boolean;
  onSelect: (id: string) => void;
  onDownload: (file: FileInfo) => void;
  onDelete: (file: FileInfo) => void;
}

interface FileState {
  selectedFiles: Set<string>;
  uploadProgress: Map<string, number>;
  previewFile: FileInfo | null;
}
```

#### è®¾è®¡æ¨¡å¼

- **æ‹–æ‹½ä¸Šä¼ **ï¼šåŸºäº react-dropzone å®ç°
- **æ–‡ä»¶ç±»å‹æ£€æµ‹**ï¼šæ™ºèƒ½çš„ MIME ç±»å‹è¯†åˆ«
- **é¢„è§ˆç­–ç•¥**ï¼šiframe åµŒå…¥å’ŒåŸç”Ÿé¢„è§ˆç»“åˆ

### 4.3 å¸ƒå±€ç»„ä»¶æ¨¡å—

#### æ¨¡å—åŠŸèƒ½æ¦‚è¿°

å¸ƒå±€æ¨¡å—è´Ÿè´£åº”ç”¨çš„å“åº”å¼å¸ƒå±€å’Œå¯¼èˆªç»“æ„ã€‚

#### æ ¸å¿ƒç»„ä»¶

- **LeftSidebar**ï¼šæˆ¿é—´è®¾ç½®å’Œç®¡ç†åŠŸèƒ½
- **RightSidebar**ï¼šæ–‡ä»¶ç®¡ç†å’Œæ“ä½œ
- **TopBar**ï¼šå…¨å±€å·¥å…·å’Œæ“ä½œæ§åˆ¶
- **MiddleColumn**ï¼šèŠå¤©ç•Œé¢å’Œç¼–è¾‘å™¨å¸ƒå±€
- **MobileLayout**ï¼šç§»åŠ¨ç«¯ä¸“ç”¨å¸ƒå±€

#### å“åº”å¼ç­–ç•¥

```typescript
const useIsMobile = () => {
  const [isMobile, setIsMobile] = useState<boolean>();

  useEffect(() => {
    const mql = window.matchMedia(`(max-width: 768px)`);
    const onChange = () => setIsMobile(window.innerWidth < 768);
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < 768);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return isMobile;
};
```

#### è®¾è®¡æ¨¡å¼

- **æ–­ç‚¹åˆ‡æ¢**ï¼šåŸºäºå±å¹•å°ºå¯¸çš„å¸ƒå±€è‡ªé€‚åº”
- **ç»„ä»¶ç»„åˆ**ï¼šå¯å¤ç”¨çš„å¸ƒå±€ç»„ä»¶è®¾è®¡
- **çŠ¶æ€åŒæ­¥**ï¼šé€šè¿‡å…¨å±€çŠ¶æ€ç®¡ç†å¸ƒå±€çŠ¶æ€

### 4.4 æˆ¿é—´ç®¡ç†ç»„ä»¶æ¨¡å—

#### æ¨¡å—åŠŸèƒ½æ¦‚è¿°

æˆ¿é—´ç®¡ç†æ¨¡å—è´Ÿè´£æˆ¿é—´çš„åˆ›å»ºã€é…ç½®ã€æƒé™æ§åˆ¶ç­‰ç®¡ç†åŠŸèƒ½ã€‚

#### æ ¸å¿ƒç»„ä»¶

- **RoomSettingsForm**ï¼šæˆ¿é—´åŸºæœ¬è®¾ç½®é…ç½®
- **RoomPermissions**ï¼šç»†ç²’åº¦æƒé™æ§åˆ¶
- **RoomSharing**ï¼šæˆ¿é—´åˆ†äº«å’Œè®¿é—®æ§åˆ¶
- **RoomCapacity**ï¼šæˆ¿é—´ä½¿ç”¨æƒ…å†µå¯è§†åŒ–
- **RoomPasswordDialog**ï¼šæˆ¿é—´å¯†ç éªŒè¯

#### æƒé™ç³»ç»Ÿè®¾è®¡

```typescript
// æƒé™ä½æ ‡å¿—å®šä¹‰
const PERMISSIONS = {
  READ: 1, // é¢„è§ˆæƒé™
  EDIT: 2, // ç¼–è¾‘æƒé™
  SHARE: 4, // åˆ†äº«æƒé™
  DELETE: 8, // åˆ é™¤æƒé™
} as const;

// æƒé™æ£€æŸ¥å‡½æ•°
const hasPermission = (token: string, permission: number): boolean => {
  const payload = decodeJWT(token);
  return (payload.permissions & permission) === permission;
};
```

#### è®¾è®¡æ¨¡å¼

- **ä½è¿ç®—**ï¼šé«˜æ•ˆçš„æƒé™æ£€æŸ¥å’Œç»„åˆ
- **ä¾èµ–ç®¡ç†**ï¼šè‡ªåŠ¨å¤„ç†æƒé™ä¾èµ–å…³ç³»
- **å®‰å…¨æ§åˆ¶**ï¼šç®¡ç†å‘˜æƒé™ä¿æŠ¤å…³é”®æ“ä½œ

### 4.5 çŠ¶æ€ç®¡ç†æ¨¡å—

#### Zustand çŠ¶æ€ç®¡ç†æ¶æ„

```typescript
interface AppState {
  // ä¸»é¢˜ç®¡ç†
  theme: Theme;
  setTheme: (theme: Theme) => void;

  // è®¾ç½®ç®¡ç†
  sendOnEnter: boolean;
  setSendOnEnter: (value: boolean) => void;

  // é€‰æ‹©ç®¡ç†
  selectedFiles: Set<string>;
  selectedMessages: Set<string>;
  toggleFileSelection: (fileId: string) => void;

  // æ¶ˆæ¯ç®¡ç†
  messages: LocalMessage[];
  addMessage: (content: string) => void;
  updateMessage: (messageId: string, content: string) => void;

  // è®¤è¯çŠ¶æ€
  isAuthenticated: (roomName?: string) => boolean;
  getCurrentRoomToken: () => TokenInfo | null;
}

const useAppStore = create<AppState>((set, get) => ({
  // çŠ¶æ€æ“ä½œå‡½æ•°
  setTheme: (theme) => set({ theme }),
  addMessage: (content) =>
    set((state) => ({
      messages: [...state.messages, {
        id: generateId(),
        content,
        isNew: true,
      }],
    })),
}));
```

#### æŒä¹…åŒ–ç­–ç•¥

```typescript
{
  name: "elizabeth-storage",
  storage: createJSONStorage(() => localStorage),
  partialize: (state) => ({
    // åªæŒä¹…åŒ– UI åå¥½è®¾ç½®
    sendOnEnter: state.sendOnEnter,
    includeMetadataInCopy: state.includeMetadataInCopy,
    editorFontSize: state.editorFontSize,
    // ... å…¶ä»– UI è®¾ç½®
  }),
}
```

### 4.6 API æœåŠ¡å±‚æ¨¡å—

#### API æœåŠ¡æ¶æ„

```typescript
// ç»Ÿä¸€çš„ API é…ç½®
const API_CONFIG = {
  baseURL: process.env.NEXT_PUBLIC_API_URL || "http://localhost:4092",
  timeout: 10000,
  retries: 3,
};

// è¯·æ±‚æ‹¦æˆªå™¨
const apiClient = axios.create({
  baseURL: API_CONFIG.baseURL,
  timeout: API_CONFIG.timeout,
});

apiClient.interceptors.request.use((config) => {
  const token = getRoomToken(config.url);
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
});

apiClient.interceptors.response.use(
  (response) => response,
  (error) => {
    if (error.response?.status === 401) {
      // è‡ªåŠ¨åˆ·æ–° token
      return refreshTokenAndRetry(error.config);
    }
    return Promise.reject(error);
  },
);
```

#### æœåŠ¡å±‚è®¾è®¡

```typescript
// è®¤è¯æœåŠ¡
class AuthService {
  async getAccessToken(roomName: string): Promise<string> {
    const response = await apiClient.post(`/auth/${roomName}`);
    return response.data.token;
  }

  async refreshToken(roomName: string): Promise<string> {
    const response = await apiClient.post(`/rooms/${roomName}/tokens`);
    return response.data.token;
  }
}

// æ¶ˆæ¯æœåŠ¡
class MessageService {
  async getMessages(roomName: string): Promise<Message[]> {
    const response = await apiClient.get(`/rooms/${roomName}/messages`);
    return response.data;
  }

  async sendMessage(roomName: string, content: string): Promise<Message> {
    const response = await apiClient.post(`/rooms/${roomName}/messages`, {
      content,
    });
    return response.data;
  }
}
```

---

## 5. å¼€å‘æµç¨‹å’Œå·¥ä½œæµ

### 5.1 å…¸å‹çš„å¼€å‘å·¥ä½œæµ

#### å¼€å‘æµç¨‹å›¾

```
éœ€æ±‚åˆ†æ â†’ æŠ€æœ¯è®¾è®¡ â†’ ç»„ä»¶å¼€å‘ â†’ APIé›†æˆ â†’ æµ‹è¯•éªŒè¯ â†’ éƒ¨ç½²ä¸Šçº¿
    â†“           â†“           â†“           â†“           â†“           â†“
æ¶æ„è®¾è®¡ â†’ çŠ¶æ€ç®¡ç† â†’ æœåŠ¡å°è£… â†’ é”™è¯¯å¤„ç† â†’ æ€§èƒ½ä¼˜åŒ–
    â†“           â†“           â†“           â†“           â†“
ä»£ç å®ç° â†’ å•å…ƒæµ‹è¯• â†’ é›†æˆæµ‹è¯• â†’ æ–‡æ¡£ç¼–å†™ â†’ ä»£ç å®¡æŸ¥
```

#### æ—¥å¸¸å¼€å‘æµç¨‹

1. **åŠŸèƒ½å¼€å‘**ï¼šåŸºäºéœ€æ±‚å®ç°æ–°åŠŸèƒ½æ¨¡å—
2. **ç»„ä»¶æµ‹è¯•**ï¼šå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
3. **API å¯¹æ¥**ï¼šå‰åç«¯æ¥å£è”è°ƒå’Œæµ‹è¯•
4. **ä»£ç å®¡æŸ¥**ï¼šä»£ç è´¨é‡æ£€æŸ¥å’Œæœ€ä½³å®è·µéªŒè¯
5. **æ–‡æ¡£æ›´æ–°**ï¼šæŠ€æœ¯æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—æ›´æ–°

### 5.2 ä»£ç ç»„ç»‡å’Œæ„å»ºæµç¨‹

#### é¡¹ç›®ç»“æ„

```
web/
â”œâ”€â”€ app/                    # Next.js App Router
â”‚   â”œâ”€â”€ [roomName]/         # åŠ¨æ€è·¯ç”±é¡µé¢
â”‚   â”œâ”€â”€ layout.tsx          # æ ¹å¸ƒå±€
â”‚   â”œâ”€â”€ page.tsx            # é¦–é¡µ
â”‚   â””â”€â”€ globals.css          # å…¨å±€æ ·å¼
â”œâ”€â”€ components/               # Reactç»„ä»¶
â”‚   â”œâ”€â”€ ui/                 # åŸºç¡€UIç»„ä»¶
â”‚   â”œâ”€â”€ chat/               # èŠå¤©ç›¸å…³ç»„ä»¶
â”‚   â”œâ”€â”€ files/              # æ–‡ä»¶ç®¡ç†ç»„ä»¶
â”‚   â”œâ”€â”€ layout/             # å¸ƒå±€ç»„ä»¶
â”‚   â”œâ”€â”€ room/               # æˆ¿é—´ç®¡ç†ç»„ä»¶
â”‚   â””â”€â”€ ...                 # å…¶ä»–åŠŸèƒ½ç»„ä»¶
â”œâ”€â”€ lib/                     # å·¥å…·åº“å’Œé…ç½®
â”‚   â”œâ”€â”€ store.ts            # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ types.ts            # TypeScriptç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ utils.ts            # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ config.ts           # APIé…ç½®
â”œâ”€â”€ api/                     # APIæœåŠ¡å±‚
â”‚   â”œâ”€â”€ authService.ts      # è®¤è¯æœåŠ¡
â”‚   â”œâ”€â”€ messageService.ts   # æ¶ˆæ¯æœåŠ¡
â”‚   â”œâ”€â”€ roomService.ts      # æˆ¿é—´æœåŠ¡
â”‚   â””â”€â”€ ...                # å…¶ä»–æœåŠ¡
â”œâ”€â”€ hooks/                   # è‡ªå®šä¹‰Hooks
â”‚   â”œâ”€â”€ use-room-permissions.ts  # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ use-mobile.ts        # ç§»åŠ¨ç«¯æ£€æµ‹
â”‚   â””â”€â”€ ...                # å…¶ä»–Hooks
â””â”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
```

#### æ„å»ºé…ç½®

```javascript
// next.config.mjs
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  experimental: {
    appDir: true,
    serverComponentsExternalPackages: ["@radix-ui/react-toast"],
  },
  images: {
    domains: ["example.com"],
  },
};

module.exports = nextConfig;
```

### 5.3 æµ‹è¯•å’Œéƒ¨ç½²æµç¨‹

#### æµ‹è¯•ç­–ç•¥

```typescript
// å•å…ƒæµ‹è¯•ç¤ºä¾‹
import { render, screen } from "@testing-library/react";
import { useAppStore } from "@/lib/store";

describe("MessageList", () => {
  it("should render messages correctly", () => {
    const mockMessages = [
      { id: "1", content: "Hello World" },
      { id: "2", content: "Test Message" },
    ];

    render(<MessageList messages={mockMessages} />);

    expect(screen.getByText("Hello World")).toBeInTheDocument();
    expect(screen.getByText("Test Message")).toBeInTheDocument();
  });
});

// é›†æˆæµ‹è¯•
import { expect, test } from "@playwright/test";
import { HomePage } from "./pages";

test("should navigate to room", async ({ page }) => {
  await page.goto("/");
  await page.click('[data-testid="create-room"]');
  await expect(page).toHaveURL(/room-test/);
});
```

#### éƒ¨ç½²æµç¨‹

```bash
# æ„å»ºå‘½ä»¤
npm run build

# ç”Ÿäº§éƒ¨ç½²
npm run start:prod

# Dockeréƒ¨ç½²
docker build -t elizabeth-frontend .
docker run -p 4001:4001 elizabeth-frontend
```

### 5.4 æ–‡æ¡£å’Œç»´æŠ¤æµç¨‹

#### æ–‡æ¡£ç»“æ„

- **API æ–‡æ¡£**ï¼šè‡ªåŠ¨ç”Ÿæˆçš„ OpenAPI æ–‡æ¡£
- **ç»„ä»¶æ–‡æ¡£**ï¼šStorybook ç»„ä»¶æ–‡æ¡£
- **å¼€å‘æŒ‡å—**ï¼šè¯¦ç»†çš„å¼€å‘ç¯å¢ƒè®¾ç½®æŒ‡å—
- **éƒ¨ç½²æ–‡æ¡£**ï¼šç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å’Œé…ç½®æŒ‡å—

#### ä»£ç ç»´æŠ¤

- **ä¾èµ–æ›´æ–°**ï¼šå®šæœŸçš„ä¾èµ–åŒ…æ›´æ–°å’Œå®‰å…¨è¡¥ä¸
- **ä»£ç é‡æ„**ï¼šå®šæœŸçš„ä»£ç è´¨é‡æ”¹è¿›å’Œæ€§èƒ½ä¼˜åŒ–
- **ç›‘æ§å‘Šè­¦**ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ª

---

## 6. æ¶æ„ä¼˜åŠ¿å’Œç‰¹ç‚¹

### 6.1 æ¶æ„çš„ä¸»è¦ä¼˜åŠ¿

#### æŠ€æœ¯ä¼˜åŠ¿

1. **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**ï¼šé‡‡ç”¨æœ€æ–°çš„ React 18ã€Next.js 14ã€TypeScript ç­‰
2. **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„ TypeScript æ”¯æŒï¼Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šReact Query ç¼“å­˜ã€ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½
4. **å¼€å‘ä½“éªŒ**ï¼šçƒ­é‡è½½ã€å¿«é€Ÿæ„å»ºã€ä¸°å¯Œçš„å¼€å‘å·¥å…·

#### æ¶æ„ä¼˜åŠ¿

1. **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„èŒè´£åˆ†ç¦»å’Œå¯å¤ç”¨ç»„ä»¶
2. **å¯æ‰©å±•æ€§**ï¼šæ’ä»¶åŒ–æ¶æ„ï¼Œæ˜“äºåŠŸèƒ½æ‰©å±•
3. **å¯ç»´æŠ¤æ€§**ï¼šè‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œæ–‡æ¡£
4. **å¯æµ‹è¯•æ€§**ï¼šç»„ä»¶é€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»

### 6.2 æŠ€æœ¯é€‰å‹çš„ç†ç”±

#### å‰ç«¯æŠ€æœ¯é€‰å‹

- **Next.js é€‰æ‹©**ï¼šæˆç†Ÿçš„ React ç”Ÿæ€ï¼Œä¸°å¯Œçš„ç»„ä»¶åº“ï¼Œä¼˜ç§€çš„æ€§èƒ½
- **Zustand é€‰æ‹©**ï¼šè½»é‡çº§çŠ¶æ€ç®¡ç†ï¼Œç®€æ´çš„ API è®¾è®¡
- **Tailwind CSS é€‰æ‹©**ï¼šå®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶ï¼Œå¿«é€Ÿå¼€å‘
- **shadcn/uié€‰æ‹©**ï¼šé«˜è´¨é‡çš„ç»„ä»¶åº“ï¼Œç°ä»£åŒ–çš„è®¾è®¡ç³»ç»Ÿ

#### åç«¯æŠ€æœ¯é€‰å‹

- **Rust é€‰æ‹©**ï¼šå†…å­˜å®‰å…¨ï¼Œé«˜æ€§èƒ½ï¼Œç±»å‹å®‰å…¨
- **Axum é€‰æ‹©**ï¼šç°ä»£å¼‚æ­¥ Web æ¡†æ¶ï¼Œä¼˜ç§€çš„æ€§èƒ½
- **SQLite é€‰æ‹©**ï¼šå¼€å‘é˜¶æ®µç®€å•ï¼Œæ— éœ€é¢å¤–åŸºç¡€è®¾æ–½

### 6.3 å¯æ‰©å±•æ€§å’Œç»´æŠ¤æ€§

#### å¯æ‰©å±•æ€§è®¾è®¡

```typescript
// æ’ä»¶åŒ–æ¶æ„ç¤ºä¾‹
interface Plugin {
  name: string;
  version: string;
  initialize: () => void;
  components: Component[];
}

const pluginRegistry = new Map<string, Plugin>();

const registerPlugin = (plugin: Plugin) => {
  pluginRegistry.set(plugin.name, plugin);
  plugin.initialize();
};
```

#### ç»´æŠ¤æ€§è®¾è®¡

- **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶åŠŸèƒ½å¼€å…³
- **ç‰ˆæœ¬ç®¡ç†**ï¼šè¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶å’Œè¿ç§»
- **ç›‘æ§é›†æˆ**ï¼šå®Œå–„çš„é”™è¯¯è¿½è¸ªå’Œæ€§èƒ½ç›‘æ§

### 6.4 æ€§èƒ½å’Œå®‰å…¨æ€§

#### æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```typescript
// ä»£ç åˆ†å‰²ç¤ºä¾‹
const LazyComponent = React.lazy(() => import("./HeavyComponent"));

// è™šæ‹Ÿæ»šåŠ¨ç¤ºä¾‹
import { FixedSizeList as List } from "react-window";

const VirtualizedList = ({ items }) => (
  <List
    height={600}
    itemCount={items.length}
    itemSize={50}
    itemData={items}
  >
    {({ index, style }) => (
      <div style={style}>
        <RowItem item={items[index]} />
      </div>
    )}
  </List>
);
```

#### å®‰å…¨æ€§è®¾è®¡

```typescript
// JWT è®¤è¯
const generateToken = (payload: JWTPayload): string => {
  return jwt.sign(payload, process.env.JWT_SECRET, {
    expiresIn: "24h",
  });
};

// æƒé™éªŒè¯
const checkPermission = (
  user: User,
  resource: string,
  action: string,
): boolean => {
  const permission = user.permissions[resource];
  return (permission & action) === action;
};

// XSS é˜²æŠ¤
const sanitizeContent = (content: string): string => {
  return DOMPurify.sanitize(content);
};
```

---

## 7. æ”¹è¿›å»ºè®®å’Œå‘å±•æ–¹å‘

### 7.1 çŸ­æœŸæ”¹è¿›å»ºè®®

#### åŠŸèƒ½å®Œå–„

1. **WebSocket å®æ—¶é€šä¿¡**ï¼š
   - å®ç°çœŸæ­£çš„å®æ—¶æ¶ˆæ¯å¹¿æ’­
   - æ·»åŠ åœ¨çº¿ç”¨æˆ·çŠ¶æ€ç®¡ç†
   - å®ç°è¿æ¥æ± ç®¡ç†å’Œé‡è¿æœºåˆ¶
   - ä¼˜åŒ–æ¶ˆæ¯ä¼ è¾“æ€§èƒ½

2. **åä½œåŠŸèƒ½å¢å¼º**ï¼š
   - å®ç°å¤šç”¨æˆ·å¹¶å‘æ§åˆ¶
   - æ·»åŠ æ“ä½œè½¬æ¢é”æœºåˆ¶
   - å®ç°å†²çªæ£€æµ‹å’Œè§£å†³
   - æ·»åŠ åä½œå†å²è®°å½•

3. **ç¼“å­˜ç³»ç»Ÿå®Œå–„**ï¼š
   - é›†æˆ Redis ç¼“å­˜å±‚
   - å®ç°æ™ºèƒ½ç¼“å­˜ç­–ç•¥
   - æ·»åŠ ç¼“å­˜å¤±æ•ˆæœºåˆ¶
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½

4. **æµ‹è¯•ä½“ç³»å®Œå–„**ï¼š
   - æ·»åŠ æ›´å¤šé›†æˆæµ‹è¯•
   - å®ç°ç«¯åˆ°ç«¯æµ‹è¯•åœºæ™¯
   - æ·»åŠ æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
   - å®Œå–„ API æ–‡æ¡£å’Œç¤ºä¾‹

### 7.2 é•¿æœŸå‘å±•è§„åˆ’

#### æ¶æ„æ¼”è¿›

1. **å¾®æœåŠ¡æ¶æ„**ï¼š
   - è¯„ä¼°å¾®æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ
   - å®ç°æœåŠ¡é—´é€šä¿¡æœºåˆ¶
   - æ·»åŠ  API ç½‘å…³å±‚
   - å®ç°åˆ†å¸ƒå¼é…ç½®ç®¡ç†

2. **CDN é›†æˆ**ï¼š
   - é›†æˆå†…å®¹åˆ†å‘ç½‘ç»œ
   - å®ç°é™æ€èµ„æºä¼˜åŒ–
   - æ·»åŠ å…¨çƒè´Ÿè½½å‡è¡¡
   - å®ç°è¾¹ç¼˜ç¼“å­˜ç­–ç•¥

3. **é«˜å¯ç”¨æ€§**ï¼š
   - å®ç°å¤šåŒºåŸŸéƒ¨ç½²
   - æ·»åŠ æ•…éšœè½¬ç§»æœºåˆ¶
   - å®ç°è‡ªåŠ¨æ‰©ç¼©å®¹
   - å®Œå–„ç¾å¤‡æ¢å¤æ–¹æ¡ˆ

### 7.3 æŠ€æœ¯å€ºåŠ¡å’Œé‡æ„è®¡åˆ’

#### å½“å‰æŠ€æœ¯å€ºåŠ¡

1. **ç±»å‹å®šä¹‰å®Œå–„**ï¼šéƒ¨åˆ†ç»„ä»¶ç¼ºå°‘å®Œæ•´çš„ TypeScript æ¥å£
2. **é”™è¯¯å¤„ç†ç»Ÿä¸€**ï¼šæŸäº› API è°ƒç”¨ç¼ºå°‘ç»Ÿä¸€çš„é”™è¯¯å¤„ç†
3. **æµ‹è¯•è¦†ç›–ä¸è¶³**ï¼šéƒ¨åˆ†å…³é”®ç»„ä»¶ç¼ºå°‘å•å…ƒæµ‹è¯•
4. **æ€§èƒ½ä¼˜åŒ–ç©ºé—´**ï¼šå¤§å‹ç»„ä»¶çš„æ¸²æŸ“æ€§èƒ½å¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–

#### é‡æ„è®¡åˆ’

1. **çŠ¶æ€ç®¡ç†ä¼˜åŒ–**ï¼šè€ƒè™‘å¼•å…¥ Immer ç®€åŒ–ä¸å¯å˜æ›´æ–°
2. **ç»„ä»¶åº“æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€ç»„ä»¶ API å’Œè®¾è®¡æ¨¡å¼
3. **API å±‚é‡æ„**ï¼šä¼˜åŒ–ç½‘ç»œè¯·æ±‚å’Œç¼“å­˜ç­–ç•¥
4. **æµ‹è¯•ä½“ç³»å®Œå–„**ï¼šå»ºç«‹å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•æµç¨‹

### 7.4 å›¢é˜Ÿåä½œå’ŒçŸ¥è¯†ç®¡ç†

#### å¼€å‘è§„èŒƒ

- **ä»£ç è§„èŒƒ**ï¼šç»Ÿä¸€çš„å‘½åçº¦å®šå’Œä»£ç é£æ ¼
- **æäº¤è§„èŒƒ**ï¼šæ¸…æ™°çš„æäº¤ä¿¡æ¯æ ¼å¼å’Œåˆ†æ”¯ç­–ç•¥
- **å®¡æŸ¥æµç¨‹**ï¼šä»£ç è´¨é‡æ£€æŸ¥å’ŒçŸ¥è¯†åˆ†äº«

#### çŸ¥è¯†ç®¡ç†

- **æ–‡æ¡£ä¸­å¿ƒ**ï¼šé›†ä¸­çš„æŠ€æœ¯æ–‡æ¡£å’Œ API æ–‡æ¡£
- **æœ€ä½³å®è·µ**ï¼šç»„ä»¶è®¾è®¡æ¨¡å¼å’Œå¼€å‘ç»éªŒæ€»ç»“
- **åŸ¹è®­ä½“ç³»**ï¼šæ–°äººå…¥èŒå’ŒæŠ€æœ¯åŸ¹è®­è®¡åˆ’

---

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ–‡æ¡£

- [Next.js å®˜æ–¹æ–‡æ¡£](https://nextjs.org/docs)
- [React å®˜æ–¹æ–‡æ¡£](https://react.dev/)
- [Zustand å®˜æ–¹æ–‡æ¡£](https://github.com/pmndrs/zustand)
- [Tailwind CSS æ–‡æ¡£](https://tailwindcss.com/docs)
- [shadcn/uiæ–‡æ¡£](https://ui.shadcn.com/)

### é¡¹ç›®èµ„æº

- [å‰ç«¯ç»„ä»¶åˆ†ææŠ¥å‘Š](./frontend-component-analysis.md)
- [çŠ¶æ€ç®¡ç†åˆ†ææŠ¥å‘Š](./frontend-state-management-analysis.md)
- [é¡¹ç›®è¿›åº¦æ–‡æ¡£](./current-progress-docs.md)
- [é›†æˆæ€»ç»“æŠ¥å‘Š](./INTEGRATION_SUMMARY.md)

### å¤–éƒ¨èµ„æº

- [MDN Web æ–‡æ¡£](https://developer.mozilla.org/)
- [TypeScript æ‰‹å†Œ](https://www.typescriptlang.org/docs/)
- [Web æ€§èƒ½ä¼˜åŒ–æŒ‡å—](https://web.dev/performance/)

---

## ğŸ“ æ–‡æ¡£ç»´æŠ¤ä¿¡æ¯

### ç‰ˆæœ¬å†å²

- v1.0 (2025-10-31)ï¼šåˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäºå·²å®Œæˆçš„åˆ†æç»“æœåˆ›å»º

### ç»´æŠ¤è®¡åˆ’

- **å®šæœŸæ›´æ–°**ï¼šæ ¹æ®é¡¹ç›®è¿›å±•åŠæ—¶æ›´æ–°æ–‡æ¡£å†…å®¹
- **ç¤¾åŒºåé¦ˆ**ï¼šæ”¶é›†å›¢é˜Ÿå’Œç”¨æˆ·çš„åé¦ˆæ„è§
- **æŠ€æœ¯è·Ÿè¸ª**ï¼šå…³æ³¨æ–°æŠ€æœ¯å’Œæœ€ä½³å®è·µçš„å‘å±•

### è”ç³»æ–¹å¼

å¦‚æœ‰æ–‡æ¡£ç›¸å…³é—®é¢˜æˆ–æ”¹è¿›å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é¡¹ç›® Issuesï¼šåœ¨é¡¹ç›®ä»“åº“ä¸­æäº¤ Issue
- æŠ€æœ¯è®¨è®ºï¼šå›¢é˜Ÿå†…éƒ¨æŠ€æœ¯è®¨è®ºç¾¤ç»„
- æ–‡æ¡£åé¦ˆï¼šç›´æ¥è”ç³»é¡¹ç›®ç»´æŠ¤å›¢é˜Ÿ

---

_æœ¬æ–‡æ¡£åŸºäº Elizabeth
é¡¹ç›®å‰ç«¯æ¶æ„çš„æ·±å…¥åˆ†æï¼Œæ•´åˆäº†ç»„ä»¶åˆ†æã€çŠ¶æ€ç®¡ç†ã€æŠ€æœ¯æ ˆã€å¼€å‘æµç¨‹ç­‰å¤šä¸ªç»´åº¦çš„ä¿¡æ¯ã€‚æ–‡æ¡£å°†æŒç»­æ›´æ–°ä»¥åæ˜ é¡¹ç›®çš„æœ€æ–°è¿›å±•ã€‚_
