# Elizabeth API æ¥å£æ–‡æ¡£

## é¡¹ç›®æ¦‚è¿°

Elizabeth æ˜¯ä¸€ä¸ªåŸºäº Rust
çš„ç°ä»£åŒ–æ–‡ä»¶åˆ†äº«å’Œåä½œå¹³å°ï¼Œé‡‡ç”¨"æˆ¿é—´ä¸ºä¸­å¿ƒ"çš„è®¾è®¡ç†å¿µï¼Œæä¾›å®‰å…¨ã€é«˜æ•ˆçš„æ–‡ä»¶å…±äº«æœåŠ¡ã€‚é¡¹ç›®æ‘’å¼ƒäº†ä¼ ç»Ÿçš„ç”¨æˆ·æ³¨å†Œç™»å½•æœºåˆ¶ï¼Œé€šè¿‡ä¸´æ—¶æˆ¿é—´å®ç°èº«ä»½éªŒè¯å’Œæƒé™ç®¡ç†ã€‚

### æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: åŸºäº Rust çš„é«˜æ€§èƒ½æ–‡ä»¶å¤„ç†
- ğŸ”’ **å®‰å…¨æ€§**: å†…å­˜å®‰å…¨å’Œæ•°æ®åŠ å¯†ï¼ŒJWT ä»¤ç‰Œè®¤è¯
- ğŸ“ **å¤šæ ¼å¼æ”¯æŒ**: æ–‡æœ¬ã€å›¾ç‰‡ã€ä»£ç ç‰‡æ®µç­‰å¤šç§æ–‡ä»¶ç±»å‹
- ğŸŒ **Web ç•Œé¢**: ç°ä»£åŒ–çš„ç”¨æˆ·ç•Œé¢
- â˜ï¸ **æœ¬åœ°å­˜å‚¨**: æ”¯æŒæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
- ğŸ  **Room ç³»ç»Ÿ**: æ”¯æŒå¯†ç ä¿æŠ¤çš„æˆ¿é—´ç³»ç»Ÿï¼Œå®ç°å®‰å…¨çš„å†…å®¹åˆ†äº«
- ğŸ“¦ **åˆ†å—ä¸Šä¼ **: æ”¯æŒå¤§æ–‡ä»¶çš„åˆ†å—ä¸Šä¼ å’Œæ–­ç‚¹ç»­ä¼ 
- ğŸ” **æƒé™ç®¡ç†**: ç»†ç²’åº¦çš„æˆ¿é—´æƒé™æ§åˆ¶ï¼ˆæŸ¥çœ‹ã€ç¼–è¾‘ã€åˆ†äº«ã€åˆ é™¤ï¼‰

### æŠ€æœ¯æ ˆ

- **åç«¯æŠ€æœ¯**:
  - Rust: æ ¸å¿ƒç¼–ç¨‹è¯­è¨€
  - Axum: å¼‚æ­¥ Web æ¡†æ¶
  - SQLx: å¼‚æ­¥ SQL å·¥å…·åŒ…ï¼Œæ”¯æŒç¼–è¯‘æ—¶æŸ¥è¯¢æ£€æŸ¥
  - SQLite: è½»é‡çº§æ•°æ®åº“
  - Tokio: å¼‚æ­¥è¿è¡Œæ—¶
  - Serde: åºåˆ—åŒ–/ååºåˆ—åŒ–
  - Utoipa: OpenAPI æ–‡æ¡£ç”Ÿæˆ
  - UUID: å”¯ä¸€æ ‡è¯†ç¬¦ç”Ÿæˆ
  - SHA256: æ–‡ä»¶å“ˆå¸Œè®¡ç®—

- **æ¶æ„æ¨¡å¼**:
  - Repository æ¨¡å¼ï¼šæ•°æ®è®¿é—®å±‚æŠ½è±¡
  - åˆ†å±‚æ¶æ„ï¼šæ¨¡å‹ã€ä»“åº“ã€å¤„ç†å™¨ã€è·¯ç”±æ¸…æ™°åˆ†ç¦»
  - ä¾èµ–æ³¨å…¥ï¼šä½¿ç”¨ Axum State ç®¡ç†ä¾èµ–
  - é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## API åŸºç¡€ä¿¡æ¯

### åŸºç¡€ URL

```
https://your-domain.com/api/v1
```

### è®¤è¯æ–¹å¼

Elizabeth é‡‡ç”¨åŸºäº JWT (JSON Web Token) çš„æ— çŠ¶æ€è®¤è¯æœºåˆ¶ï¼š

1. **æˆ¿é—´å¯†ç ä¿æŠ¤**: æˆ¿é—´å¯ä»¥è®¾ç½®å¯†ç ä¿æŠ¤è®¿é—®
2. **JWT ä»¤ç‰Œ**: é€šè¿‡æˆ¿é—´å¯†ç è·å–è®¿é—®ä»¤ç‰Œ
3. **æƒé™åµŒå…¥**: JWT ä»¤ç‰Œä¸­åµŒå…¥æƒé™ä¿¡æ¯ï¼Œå‡å°‘å®æ—¶æ•°æ®åº“æŸ¥è¯¢
4. **åˆ·æ–°ä»¤ç‰Œ**: æ”¯æŒä»¤ç‰Œåˆ·æ–°æœºåˆ¶ï¼Œå»¶é•¿è®¿é—®æ—¶é—´

### è®¤è¯æµç¨‹

1. **åˆ›å»º/è®¿é—®æˆ¿é—´**: ç”¨æˆ·é€šè¿‡æˆ¿é—´åç§°è®¿é—®æˆ–åˆ›å»ºæˆ¿é—´
2. **å¯†ç éªŒè¯**: å¦‚æœæˆ¿é—´è®¾ç½®äº†å¯†ç ï¼Œéœ€è¦æä¾›æ­£ç¡®å¯†ç 
3. **è·å–ä»¤ç‰Œ**: éªŒè¯é€šè¿‡åè·å¾— JWT è®¿é—®ä»¤ç‰Œï¼ˆå¯é€‰æ‹©è·å–åˆ·æ–°ä»¤ç‰Œï¼‰
4. **API è°ƒç”¨**: åœ¨åç»­ API è¯·æ±‚ä¸­é€šè¿‡æŸ¥è¯¢å‚æ•° `token` ä¼ é€’è®¿é—®ä»¤ç‰Œ
5. **ä»¤ç‰Œç»­æœŸ**: è®¿é—®ä»¤ç‰Œè¿‡æœŸå‰å¯ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ

### ä»¤ç‰Œä½¿ç”¨æ–¹å¼

- **è®¿é—®ä»¤ç‰Œ**: é€šè¿‡æŸ¥è¯¢å‚æ•° `token` ä¼ é€’ï¼Œä¾‹å¦‚
  `/api/v1/rooms/myroom/contents?token=your_access_token`
- **åˆ·æ–°ä»¤ç‰Œ**: é€šè¿‡è¯·æ±‚ä½“ä¼ é€’ç»™ `/api/v1/auth/refresh` ç«¯ç‚¹
- **ä»¤ç‰Œæ’¤é”€**: é€šè¿‡ `/api/v1/auth/logout` æˆ–
  `/api/v1/rooms/{name}/tokens/{jti}` æ’¤é”€ä»¤ç‰Œ

### é€šç”¨æ ¼å¼

- **è¯·æ±‚æ ¼å¼**: JSON
- **å“åº”æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8
- **æ—¶é—´æ ¼å¼**: ISO 8601 (RFC 3339)
- **é”™è¯¯å¤„ç†**: HTTP çŠ¶æ€ç  + æ¶ˆæ¯å­—ç¬¦ä¸²æ ¼å¼

### çŠ¶æ€ç è¯´æ˜

| çŠ¶æ€ç  | å«ä¹‰                   | æè¿°                                                     |
| ------ | ---------------------- | -------------------------------------------------------- |
| 200    | OK                     | è¯·æ±‚æˆåŠŸ                                                 |
| 400    | Bad Request            | è¯·æ±‚å‚æ•°é”™è¯¯ï¼Œå¦‚å‚æ•°æ ¼å¼ä¸æ­£ç¡®ã€ç¼ºå°‘å¿…éœ€å‚æ•°ç­‰           |
| 401    | Unauthorized           | è®¤è¯å¤±è´¥ï¼Œå¦‚ä»¤ç‰Œæ— æ•ˆã€å¯†ç é”™è¯¯ã€ä»¤ç‰Œè¿‡æœŸç­‰               |
| 403    | Forbidden              | æƒé™ä¸è¶³ï¼Œå¦‚ä»¤ç‰Œæƒé™ä¸å¤Ÿã€æˆ¿é—´ä¸å¯è¿›å…¥ã€èµ„æºä¸å±äºæˆ¿é—´ç­‰ |
| 404    | Not Found              | èµ„æºä¸å­˜åœ¨ï¼Œå¦‚æˆ¿é—´ã€æ–‡ä»¶ã€é¢„ç•™è®°å½•ä¸å­˜åœ¨ç­‰               |
| 409    | Conflict               | èµ„æºå†²çªï¼Œå¦‚åˆ†å—å·²å­˜åœ¨ã€æ–‡ä»¶åˆå¹¶çŠ¶æ€ä¸æ­£ç¡®ç­‰             |
| 410    | Gone                   | èµ„æºå·²è¿‡æœŸï¼Œå¦‚æˆ¿é—´å·²è¿‡æœŸ                                 |
| 413    | Payload Too Large      | æ–‡ä»¶è¿‡å¤§ï¼Œè¶…å‡ºæˆ¿é—´å®¹é‡é™åˆ¶                               |
| 415    | Unsupported Media Type | ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹                                         |
| 500    | Internal Server Error  | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œå¦‚æ•°æ®åº“é”™è¯¯ã€æ–‡ä»¶ç³»ç»Ÿé”™è¯¯ç­‰             |
| 507    | Insufficient Storage   | å­˜å‚¨ç©ºé—´ä¸è¶³                                             |

## API æ¥å£è¯¦æƒ…

### 1. æˆ¿é—´ç®¡ç† API

#### 1.1 åˆ›å»ºæˆ¿é—´

**æ¥å£æè¿°**: åˆ›å»ºä¸€ä¸ªæ–°çš„æˆ¿é—´ï¼Œæ”¯æŒå¯†ç ä¿æŠ¤å’Œå„ç§é…ç½®é€‰é¡¹

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°ï¼Œå¿…é¡»å”¯ä¸€
- **æŸ¥è¯¢å‚æ•°**:
  - `password` (string, å¯é€‰): æˆ¿é—´å¯†ç ï¼Œç”¨äºä¿æŠ¤æˆ¿é—´è®¿é—®

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST "https://your-domain.com/api/v1/rooms/myroom?password=secret123"
```

**å“åº”æ ¼å¼**:

```json
{
  "id": 1,
  "name": "myroom",
  "slug": "myroom",
  "password": "secret123",
  "status": 0,
  "max_size": 10485760,
  "current_size": 0,
  "max_times_entered": 100,
  "current_times_entered": 0,
  "expire_at": null,
  "created_at": "2023-01-01T12:00:00Z",
  "updated_at": "2023-01-01T12:00:00Z",
  "permission": 15
}
```

**çŠ¶æ€ç **:

- 200: åˆ›å»ºæˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯ï¼ˆå¦‚æˆ¿é—´åä¸ºç©ºï¼‰
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 1.2 æŸ¥è¯¢æˆ¿é—´

**æ¥å£æè¿°**: æ ¹æ®æˆ¿é—´åç§°æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/rooms/{name}`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET "https://your-domain.com/api/v1/rooms/myroom"
```

**å“åº”æ ¼å¼**:

```json
{
  "id": 1,
  "name": "myroom",
  "slug": "myroom",
  "password": "secret123",
  "status": 0,
  "max_size": 10485760,
  "current_size": 0,
  "max_times_entered": 100,
  "current_times_entered": 0,
  "expire_at": null,
  "created_at": "2023-01-01T12:00:00Z",
  "updated_at": "2023-01-01T12:00:00Z",
  "permission": 15
}
```

**çŠ¶æ€ç **:

- 200: æŸ¥è¯¢æˆåŠŸ
- 403: æˆ¿é—´æ— æ³•è¿›å…¥ï¼ˆå·²è¿‡æœŸã€å·²å…³é—­æˆ–å·²æ»¡å‘˜ï¼‰
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 1.3 åˆ é™¤æˆ¿é—´

**æ¥å£æè¿°**: åˆ é™¤æŒ‡å®šæˆ¿é—´åŠå…¶æ‰€æœ‰ç›¸å…³å†…å®¹

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: DELETE
- **URL**: `/api/v1/rooms/{name}`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡åˆ é™¤æƒé™

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X DELETE "https://your-domain.com/api/v1/rooms/myroom?token=your_access_token"
```

**å“åº”æ ¼å¼**:

```json
{
  "message": "Room deleted successfully"
}
```

**çŠ¶æ€ç **:

- 200: åˆ é™¤æˆåŠŸ
- 400: æˆ¿é—´åç§°æ— æ•ˆ
- 401: ä»¤ç‰Œæ— æ•ˆæˆ–æƒé™ä¸è¶³
- 403: æƒé™ä¸è¶³
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 410: æˆ¿é—´å·²è¿‡æœŸ
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 2. è®¤è¯å’Œæƒé™ API

#### 2.1 è·å–è®¿é—®ä»¤ç‰Œ

**æ¥å£æè¿°**: é€šè¿‡æˆ¿é—´å¯†ç è·å–è®¿é—®ä»¤ç‰Œï¼Œæ”¯æŒåˆ·æ–°ä»¤ç‰Œæœºåˆ¶

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/tokens`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **è¯·æ±‚ä½“**:

```json
{
  "password": "secret123",
  "token": null,
  "with_refresh_token": true
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `password` (string, å¯é€‰): æˆ¿é—´å¯†ç ï¼Œå¦‚æœæˆ¿é—´è®¾ç½®äº†å¯†ç åˆ™å¿…é¡»æä¾›
- `token` (string, å¯é€‰): å·²æœ‰çš„æˆ¿é—´ä»¤ç‰Œï¼Œå¯ç”¨äºæ— éœ€å¯†ç çš„æƒ…å†µä¸‹ç»­ç­¾
- `with_refresh_token` (boolean, å¯é€‰): æ˜¯å¦è¯·æ±‚åˆ·æ–°ä»¤ç‰Œå¯¹ï¼Œé»˜è®¤ä¸º false

**å“åº”æ ¼å¼**:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "claims": {
    "sub": "room:1",
    "room_id": 1,
    "room_name": "myroom",
    "permission": 15,
    "max_size": 10485760,
    "exp": 1704067200,
    "iat": 1704063600,
    "jti": "550e8400-e29b-41d4-a716-446655440000"
  },
  "expires_at": "2023-01-01T13:00:00Z",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token_expires_at": "2023-01-08T13:00:00Z"
}
```

**çŠ¶æ€ç **:

- 200: ç­¾å‘æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 403: æƒé™ä¸è¶³æˆ–æˆ¿é—´ä¸å¯è¿›å…¥
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 2.2 éªŒè¯ä»¤ç‰Œ

**æ¥å£æè¿°**: éªŒè¯æˆ¿é—´è®¿é—®ä»¤ç‰Œçš„æœ‰æ•ˆæ€§

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/tokens/validate`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **è¯·æ±‚ä½“**:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**å“åº”æ ¼å¼**:

```json
{
  "claims": {
    "sub": "room:1",
    "room_id": 1,
    "room_name": "myroom",
    "permission": 15,
    "max_size": 10485760,
    "exp": 1704067200,
    "iat": 1704063600,
    "jti": "550e8400-e29b-41d4-a716-446655440000"
  }
}
```

**çŠ¶æ€ç **:

- 200: å‡­è¯æœ‰æ•ˆ
- 401: å‡­è¯æ— æ•ˆæˆ–å·²æ’¤é”€
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 2.3 æ’¤é”€ä»¤ç‰Œ

**æ¥å£æè¿°**: æ’¤é”€æŒ‡å®šçš„æˆ¿é—´è®¿é—®ä»¤ç‰Œ

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: DELETE
- **URL**: `/api/v1/rooms/{name}/tokens/{jti}`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
  - `jti` (string, å¿…éœ€): è¦æ’¤é”€çš„ä»¤ç‰Œæ ‡è¯†
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): ä»»ä¸€æœ‰æ•ˆæˆ¿é—´ä»¤ç‰Œ

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X DELETE "https://your-domain.com/api/v1/rooms/myroom/tokens/550e8400-e29b-41d4-a716-446655440000?token=your_valid_token"
```

**å“åº”æ ¼å¼**:

```json
{
  "revoked": true
}
```

**çŠ¶æ€ç **:

- 200: æ’¤é”€æˆåŠŸ
- 401: å‡­è¯æ— æ•ˆæˆ–å·²æ’¤é”€
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 2.4 è·å–ä»¤ç‰Œåˆ—è¡¨

**æ¥å£æè¿°**: è·å–æŒ‡å®šæˆ¿é—´çš„æ‰€æœ‰æœ‰æ•ˆä»¤ç‰Œåˆ—è¡¨

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/rooms/{name}/tokens`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): ä»»ä¸€æœ‰æ•ˆæˆ¿é—´ä»¤ç‰Œ

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET "https://your-domain.com/api/v1/rooms/myroom/tokens?token=your_valid_token"
```

**å“åº”æ ¼å¼**:

```json
[
  {
    "jti": "550e8400-e29b-41d4-a716-446655440000",
    "expires_at": "2023-01-01T13:00:00Z",
    "revoked_at": null,
    "created_at": "2023-01-01T12:00:00Z"
  }
]
```

**çŠ¶æ€ç **:

- 200: æŸ¥è¯¢æˆåŠŸ
- 401: å‡­è¯æ— æ•ˆæˆ–å·²æ’¤é”€
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 2.5 æ›´æ–°æˆ¿é—´æƒé™

**æ¥å£æè¿°**: æ›´æ–°æˆ¿é—´çš„æƒé™è®¾ç½®

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/permissions`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡åˆ é™¤æƒé™
- **è¯·æ±‚ä½“**:

```json
{
  "edit": true,
  "share": true,
  "delete": false
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `edit` (boolean, å¯é€‰): æ˜¯å¦æˆäºˆç¼–è¾‘æƒé™
- `share` (boolean, å¯é€‰): æ˜¯å¦æˆäºˆåˆ†äº«æƒé™
- `delete` (boolean, å¯é€‰): æ˜¯å¦æˆäºˆåˆ é™¤æƒé™

**å“åº”æ ¼å¼**:

```json
{
  "id": 1,
  "name": "myroom",
  "slug": "myroom",
  "password": "secret123",
  "status": 0,
  "max_size": 10485760,
  "current_size": 0,
  "max_times_entered": 100,
  "current_times_entered": 0,
  "expire_at": null,
  "created_at": "2023-01-01T12:00:00Z",
  "updated_at": "2023-01-01T12:00:00Z",
  "permission": 15
}
```

**çŠ¶æ€ç **:

- 200: æƒé™æ›´æ–°æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆæˆ–æƒé™ä¸è¶³
- 403: æ— æ›´æ–°æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 3. å†…å®¹ç®¡ç† API

#### 3.1 è·å–å†…å®¹åˆ—è¡¨

**æ¥å£æè¿°**: è·å–æˆ¿é—´å†…çš„æ‰€æœ‰æ–‡ä»¶å’Œå†…å®¹åˆ—è¡¨

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/rooms/{name}/contents`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡æŸ¥çœ‹æƒé™

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET "https://your-domain.com/api/v1/rooms/myroom/contents?token=your_access_token"
```

**å“åº”æ ¼å¼**:

```json
[
  {
    "id": 1,
    "content_type": 0,
    "file_name": "document.pdf",
    "url": null,
    "size": 1024000,
    "mime_type": "application/pdf",
    "created_at": "2023-01-01T12:30:00Z",
    "updated_at": "2023-01-01T12:30:00Z"
  },
  {
    "id": 2,
    "content_type": 1,
    "file_name": null,
    "url": "https://example.com",
    "size": null,
    "mime_type": "text/html",
    "created_at": "2023-01-01T12:35:00Z",
    "updated_at": "2023-01-01T12:35:00Z"
  }
]
```

**çŠ¶æ€ç **:

- 200: æŸ¥è¯¢æˆåŠŸ
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— æŸ¥çœ‹æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 3.2 é¢„ç•™ä¸Šä¼ ç©ºé—´

**æ¥å£æè¿°**: ä¸ºæ–‡ä»¶ä¸Šä¼ é¢„ç•™ç©ºé—´ï¼Œé¿å…å¹¶å‘ä¸Šä¼ å†²çª

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/contents/prepare`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡ç¼–è¾‘æƒé™
- **è¯·æ±‚ä½“**:

```json
{
  "files": [
    {
      "name": "document.pdf",
      "size": 1024000,
      "mime": "application/pdf"
    }
  ]
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `files` (array, å¿…éœ€): è¦ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨ï¼Œæ¯ä¸ªæ–‡ä»¶åŒ…å«åç§°ã€å¤§å°å’Œ MIME ç±»å‹

**å“åº”æ ¼å¼**:

```json
{
  "reservation_id": 12345,
  "reserved_size": 1024000,
  "expires_at": "2023-01-01T13:10:00Z",
  "current_size": 5120000,
  "remaining_size": 5365760,
  "max_size": 10485760
}
```

**çŠ¶æ€ç **:

- 200: é¢„ç•™æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 413: è¶…å‡ºæˆ¿é—´å®¹é‡é™åˆ¶
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 3.3 ä¸Šä¼ æ–‡ä»¶

**æ¥å£æè¿°**: ä¸Šä¼ æ–‡ä»¶åˆ°æˆ¿é—´

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/contents`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡ç¼–è¾‘æƒé™
  - `reservation_id` (number, å¿…éœ€): ä¸Šä¼ é¢„ç•™ ID
- **è¯·æ±‚ä½“**: multipart/form-data
  - `file`: è¦ä¸Šä¼ çš„æ–‡ä»¶

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/contents?token=your_access_token&reservation_id=12345" \
  -F "file=@document.pdf"
```

**å“åº”æ ¼å¼**:

```json
{
  "uploaded": [
    {
      "id": 1,
      "content_type": 0,
      "file_name": "document.pdf",
      "url": null,
      "size": 1024000,
      "mime_type": "application/pdf",
      "created_at": "2023-01-01T12:30:00Z",
      "updated_at": "2023-01-01T12:30:00Z"
    }
  ],
  "current_size": 6144000
}
```

**çŠ¶æ€ç **:

- 200: ä¸Šä¼ æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨æˆ–é¢„ç•™ä¸å­˜åœ¨
- 413: è¶…å‡ºæˆ¿é—´å®¹é‡é™åˆ¶
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 3.4 ä¸‹è½½æ–‡ä»¶

**æ¥å£æè¿°**: ä¸‹è½½æˆ¿é—´å†…çš„æŒ‡å®šæ–‡ä»¶

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/rooms/{name}/contents/{content_id}`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
  - `content_id` (number, å¿…éœ€): å†…å®¹ ID
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡æŸ¥çœ‹æƒé™

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET "https://your-domain.com/api/v1/rooms/myroom/contents/1?token=your_access_token" \
  -o downloaded_file.pdf
```

**å“åº”**: æ–‡ä»¶æµ **çŠ¶æ€ç **:

- 200: ä¸‹è½½æˆåŠŸ
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— æŸ¥çœ‹æƒé™
- 404: æˆ¿é—´æˆ–æ–‡ä»¶ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 3.5 åˆ é™¤å†…å®¹

**æ¥å£æè¿°**: åˆ é™¤æˆ¿é—´å†…çš„æŒ‡å®šæ–‡ä»¶

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: DELETE
- **URL**: `/api/v1/rooms/{name}/contents`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°**:
  - `token` (string, å¿…éœ€): æœ‰æ•ˆçš„æˆ¿é—´ä»¤ç‰Œï¼Œéœ€å…·å¤‡åˆ é™¤æƒé™
- **è¯·æ±‚ä½“**:

```json
{
  "ids": [1, 2, 3]
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `ids` (array, å¿…éœ€): è¦åˆ é™¤çš„å†…å®¹ ID åˆ—è¡¨

**å“åº”æ ¼å¼**:

```json
{
  "deleted": [1, 2, 3],
  "freed_size": 2048000,
  "current_size": 4096000
}
```

**çŠ¶æ€ç **:

- 200: åˆ é™¤æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— åˆ é™¤æƒé™
- 404: æˆ¿é—´æˆ–æ–‡ä»¶ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 4. åˆ†å—ä¸Šä¼  API

#### 4.1 é¢„ç•™åˆ†å—ä¸Šä¼ 

**æ¥å£æè¿°**: ä¸ºå¤§æ–‡ä»¶ä¸Šä¼ é¢„ç•™åˆ†å—ä¸Šä¼ ç©ºé—´

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/uploads/chunks/prepare`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **è¯·æ±‚ä½“**:

```json
{
  "files": [
    {
      "name": "large_video.mp4",
      "size": 104857600,
      "mime": "video/mp4",
      "chunk_size": 1048576,
      "file_hash": "sha256_hash_of_file"
    }
  ]
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `files` (array, å¿…éœ€): è¦ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨
  - `name` (string): æ–‡ä»¶å
  - `size` (integer): æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  - `mime` (string, å¯é€‰): MIME ç±»å‹
  - `chunk_size` (integer, å¯é€‰): åˆ†å—å¤§å°ï¼Œé»˜è®¤ 1MB
  - `file_hash` (string, å¯é€‰): æ–‡ä»¶ SHA256 å“ˆå¸Œå€¼

**å“åº”æ ¼å¼**:

```json
{
  "reservation_id": "550e8400-e29b-41d4-a716-446655440000",
  "upload_token": "upload_token_string",
  "expires_at": "2023-01-01T13:10:00Z",
  "files": [
    {
      "name": "large_video.mp4",
      "size": 104857600,
      "mime": "video/mp4",
      "chunk_size": 1048576,
      "total_chunks": 100,
      "file_hash": "sha256_hash_of_file"
    }
  ]
}
```

**çŠ¶æ€ç **:

- 200: é¢„ç•™æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨
- 413: è¶…å‡ºæˆ¿é—´å®¹é‡é™åˆ¶
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 4.2 ä¸Šä¼ åˆ†å—

**æ¥å£æè¿°**: ä¸Šä¼ æ–‡ä»¶åˆ†å—

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/uploads/chunks`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **è¯·æ±‚ä½“**: multipart/form-data
  - `upload_token` (string, å¿…éœ€): ä¸Šä¼ ä»¤ç‰Œï¼ˆä»é¢„ç•™å“åº”ä¸­è·å¾—ï¼‰
  - `chunk_index` (integer, å¿…éœ€): åˆ†å—ç´¢å¼•ï¼ˆä» 0 å¼€å§‹ï¼‰
  - `chunk_size` (integer, å¿…éœ€): åˆ†å—å¤§å°
  - `chunk_hash` (string, å¯é€‰): åˆ†å— SHA256 å“ˆå¸Œå€¼
  - `chunk_data` (binary, å¿…éœ€): åˆ†å—äºŒè¿›åˆ¶æ•°æ®

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks" \
  -F "upload_token=upload_token_string" \
  -F "chunk_index=0" \
  -F "chunk_size=1048576" \
  -F "chunk_hash=sha256_hash_of_chunk" \
  -F "chunk_data=@chunk_0.bin"
```

**å“åº”æ ¼å¼**:

```json
{
  "chunk_index": 0,
  "chunk_size": 1048576,
  "chunk_hash": "sha256_hash_of_chunk",
  "upload_status": "Uploaded",
  "uploaded_at": "2023-01-01T12:30:00Z"
}
```

**çŠ¶æ€ç **:

- 200: ä¸Šä¼ æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨æˆ–ä¸Šä¼ ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 4.3 æŸ¥è¯¢ä¸Šä¼ çŠ¶æ€

**æ¥å£æè¿°**: æŸ¥è¯¢åˆ†å—ä¸Šä¼ çš„è¿›åº¦çŠ¶æ€

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/rooms/{name}/uploads/chunks/status`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **æŸ¥è¯¢å‚æ•°** (äºŒé€‰ä¸€):
  - `upload_token` (string, å¯é€‰): ä¸Šä¼ ä»¤ç‰Œ
  - `reservation_id` (string, å¯é€‰): é¢„ç•™ ID

**è¯·æ±‚ç¤ºä¾‹**:

```bash
curl -X GET "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks/status?upload_token=upload_token_string"
```

**å“åº”æ ¼å¼**:

```json
{
  "reservation_id": "550e8400-e29b-41d4-a716-446655440000",
  "upload_token": "upload_token_string",
  "upload_status": "Uploading",
  "total_chunks": 100,
  "uploaded_chunks": 65,
  "progress_percentage": 65.0,
  "expires_at": "2023-01-01T13:10:00Z",
  "chunk_details": [
    {
      "chunk_index": 0,
      "chunk_size": 1048576,
      "chunk_hash": "sha256_hash_of_chunk",
      "upload_status": "Uploaded",
      "uploaded_at": "2023-01-01T12:30:00Z"
    }
  ],
  "reserved_size": 104857600,
  "uploaded_size": 68157440,
  "is_expired": false,
  "remaining_seconds": 2400
}
```

**çŠ¶æ€ç **:

- 200: æŸ¥è¯¢æˆåŠŸ
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨æˆ–ä¸Šä¼ ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 4.4 å®Œæˆæ–‡ä»¶åˆå¹¶

**æ¥å£æè¿°**: å®Œæˆåˆ†å—ä¸Šä¼ å¹¶åˆå¹¶æ–‡ä»¶

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/rooms/{name}/uploads/chunks/complete`
- **è·¯å¾„å‚æ•°**:
  - `name` (string, å¿…éœ€): æˆ¿é—´åç§°
- **è¯·æ±‚ä½“**:

```json
{
  "reservation_id": 12345,
  "final_hash": "sha256_hash_of_complete_file"
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `reservation_id` (integer, å¿…éœ€): é¢„ç•™ ID
- `final_hash` (string, å¿…éœ€): å®Œæ•´æ–‡ä»¶çš„ SHA256 å“ˆå¸Œå€¼ï¼Œç”¨äºéªŒè¯æ–‡ä»¶å®Œæ•´æ€§

**å“åº”æ ¼å¼**:

```json
{
  "reservation_id": 12345,
  "upload_status": "Completed",
  "file_info": {
    "name": "large_video.mp4",
    "size": 104857600,
    "hash": "sha256_hash_of_complete_file",
    "path": "storage/rooms/123/large_video.mp4"
  }
}
```

**çŠ¶æ€ç **:

- 200: åˆå¹¶æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: ä»¤ç‰Œæ— æ•ˆ
- 403: æ— ç¼–è¾‘æƒé™
- 404: æˆ¿é—´ä¸å­˜åœ¨æˆ–ä¸Šä¼ ä¸å­˜åœ¨
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 5. ç³»ç»ŸçŠ¶æ€ API

#### 5.1 å¥åº·æ£€æŸ¥

**æ¥å£æè¿°**: æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/health`

**å“åº”æ ¼å¼**:

```json
{
  "status": "ok",
  "timestamp": "2023-01-01T12:00:00Z"
}
```

**çŠ¶æ€ç **:

- 200: æœåŠ¡æ­£å¸¸è¿è¡Œ

#### 5.2 ç³»ç»ŸçŠ¶æ€

**æ¥å£æè¿°**: è·å–ç³»ç»Ÿè¯¦ç»†çŠ¶æ€ä¿¡æ¯

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: GET
- **URL**: `/api/v1/status`

**å“åº”æ ¼å¼**:

```json
{
  "uptime": "2023-01-01T12:00:00Z",
  "memory": "45MB",
  "cpu": "12%"
}
```

**çŠ¶æ€ç **:

- 200: æŸ¥è¯¢æˆåŠŸ
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### 6. è®¤è¯ç®¡ç† API

#### 6.1 åˆ·æ–°è®¿é—®ä»¤ç‰Œ

**æ¥å£æè¿°**: ä½¿ç”¨åˆ·æ–°ä»¤ç‰Œè·å–æ–°çš„è®¿é—®ä»¤ç‰Œ

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/auth/refresh`
- **è¯·æ±‚ä½“**:

```json
{
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**å“åº”æ ¼å¼**:

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "access_token_expires_at": "2023-01-01T13:00:00Z",
  "refresh_token_expires_at": "2023-01-08T13:00:00Z"
}
```

**çŠ¶æ€ç **:

- 200: åˆ·æ–°æˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: æ— æ•ˆçš„åˆ·æ–°ä»¤ç‰Œ
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 6.2 ç™»å‡º

**æ¥å£æè¿°**: æ’¤é”€è®¿é—®ä»¤ç‰Œå’Œå…³è”çš„åˆ·æ–°ä»¤ç‰Œ

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: POST
- **URL**: `/api/v1/auth/logout`
- **è¯·æ±‚ä½“**:

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**è¯·æ±‚å‚æ•°è¯´æ˜**:

- `access_token` (string, å¿…éœ€): è¦æ’¤é”€çš„è®¿é—®ä»¤ç‰Œ

**å“åº”æ ¼å¼**:

```json
{
  "message": "Token revoked successfully"
}
```

**çŠ¶æ€ç **:

- 200: ç™»å‡ºæˆåŠŸ
- 400: è¯·æ±‚å‚æ•°é”™è¯¯
- 401: æ— æ•ˆçš„ä»¤ç‰Œ
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

#### 6.3 æ¸…ç†è¿‡æœŸä»¤ç‰Œ (ä»…é™ç®¡ç†å‘˜)

**æ¥å£æè¿°**: æ¸…ç†è¿‡æœŸçš„ä»¤ç‰Œå’Œé¢„ç•™è®°å½•

**è¯·æ±‚ä¿¡æ¯**:

- **æ–¹æ³•**: DELETE
- **URL**: `/api/v1/auth/cleanup`

**å“åº”æ ¼å¼**:

```json
{
  "cleaned_records": 15,
  "message": "Cleanup completed successfully"
}
```

**å“åº”å‚æ•°è¯´æ˜**:

- `cleaned_records` (integer): æ¸…ç†çš„è®°å½•æ•°é‡
- `message` (string): æ“ä½œç»“æœæ¶ˆæ¯

**çŠ¶æ€ç **:

- 200: æ¸…ç†æˆåŠŸ
- 500: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

## æƒé™æœºåˆ¶è¯¦è§£

### æƒé™ä½æ ‡å¿—

Elizabeth ä½¿ç”¨ä½æ ‡å¿—æ¥è¡¨ç¤ºæˆ¿é—´æƒé™ï¼š

| æƒé™      | ä½æ ‡å¿— | æè¿°     |
| --------- | ------ | -------- |
| VIEW_ONLY | 1      | æŸ¥çœ‹æƒé™ |
| EDITABLE  | 2      | ç¼–è¾‘æƒé™ |
| SHARE     | 4      | åˆ†äº«æƒé™ |
| DELETE    | 8      | åˆ é™¤æƒé™ |

### æƒé™ç»„åˆ

- **é»˜è®¤æƒé™**: 15 (VIEW_ONLY | EDITABLE | SHARE | DELETE) - æ‰€æœ‰æƒé™
- **åªè¯»æƒé™**: 1 - ä»…æŸ¥çœ‹
- **ç¼–è¾‘æƒé™**: 3 (VIEW_ONLY | EDITABLE) - æŸ¥çœ‹å’Œç¼–è¾‘
- **åˆ†äº«æƒé™**: 5 (VIEW_ONLY | EDITABLE | SHARE) - æŸ¥çœ‹ã€ç¼–è¾‘å’Œåˆ†äº«
- **å®Œå…¨æƒé™**: 7 (VIEW_ONLY | EDITABLE | SHARE | DELETE) - æ‰€æœ‰æƒé™

### JWT ä»¤ç‰Œç»“æ„

```json
{
  "sub": "room:1",
  "room_id": 1,
  "room_name": "myroom",
  "permission": 15,
  "max_size": 10485760,
  "exp": 1704067200,
  "iat": 1704063600,
  "jti": "550e8400-e29b-41d4-a716-446655440000"
}
```

**å­—æ®µè¯´æ˜**:

- `sub`: ä¸»é¢˜æ ‡è¯†ï¼Œæ ¼å¼ä¸º "room:{room_id}"
- `room_id`: æˆ¿é—´æ•°æ®åº“ ID
- `room_name`: æˆ¿é—´åç§°
- `permission`: æƒé™ä½æ ‡å¿—
- `max_size`: æˆ¿é—´æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶
- `exp`: ä»¤ç‰Œè¿‡æœŸæ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
- `iat`: ä»¤ç‰Œç­¾å‘æ—¶é—´ï¼ˆUnix æ—¶é—´æˆ³ï¼‰
- `jti`: ä»¤ç‰Œå”¯ä¸€æ ‡è¯†ç¬¦

## é”™è¯¯å¤„ç†

### é”™è¯¯å“åº”æ ¼å¼

Elizabeth API ä½¿ç”¨ HTTP çŠ¶æ€ç å’Œç®€å•æ¶ˆæ¯å­—ç¬¦ä¸²è¿›è¡Œé”™è¯¯å“åº”ï¼Œè€Œä¸æ˜¯ JSON
æ ¼å¼ã€‚å¤§éƒ¨åˆ†é”™è¯¯ç›´æ¥è¿”å›å¸¦æœ‰æ¶ˆæ¯çš„ HTTP å“åº”ã€‚

**ç¤ºä¾‹é”™è¯¯å“åº”**:

- `400 Bad Request`: `"Invalid room name"`
- `401 Unauthorized`: `"Invalid or expired refresh token"`
- `403 Forbidden`: `"Permission denied by token"`
- `404 Not Found`: `"Room not found"`
- `409 Conflict`: `"Chunk already exists"`
- `410 Gone`: `"Room has expired"`
- `413 Payload Too Large`: `"Room size limit exceeded"`
- `500 Internal Server Error`: `"Database error: connection failed"`

## ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

### å®Œæ•´å·¥ä½œæµç¨‹ç¤ºä¾‹

#### 1. åˆ›å»ºæˆ¿é—´å¹¶ä¸Šä¼ æ–‡ä»¶

```bash
# 1. åˆ›å»ºæˆ¿é—´
curl -X POST "https://your-domain.com/api/v1/rooms/myroom?password=secret123"

# 2. è·å–è®¿é—®ä»¤ç‰Œ
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/tokens" \
  -H "Content-Type: application/json" \
  -d '{"password": "secret123", "with_refresh_token": true}'

# 3. é¢„ç•™ä¸Šä¼ ç©ºé—´
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/contents/prepare?token=YOUR_ACCESS_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"files": [{"name": "document.pdf", "size": 1024000, "mime": "application/pdf"}]}'

# 4. ä¸Šä¼ æ–‡ä»¶
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/contents?token=YOUR_ACCESS_TOKEN&reservation_id=12345" \
  -F "file=@document.pdf"
```

#### 2. åˆ†å—ä¸Šä¼ å¤§æ–‡ä»¶

```bash
# 1. é¢„ç•™åˆ†å—ä¸Šä¼ 
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks/prepare" \
  -H "Content-Type: application/json" \
  -d '{
    "files": [
      {
        "name": "large_video.mp4",
        "size": 104857600,
        "mime": "video/mp4",
        "chunk_size": 1048576,
        "file_hash": "sha256_hash_of_complete_file"
      }
    ]
  }'

# å“åº”ä¼šåŒ…å« reservation_id å’Œ upload_token
# 2. ä¸Šä¼ åˆ†å—ï¼ˆå¾ªç¯ï¼‰
for i in {0..99}; do
  curl -X POST "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks" \
    -F "upload_token=upload_token_from_step1" \
    -F "chunk_index=$i" \
    -F "chunk_size=1048576" \
    -F "chunk_hash=sha256_hash_of_chunk_$i" \
    -F "chunk_data=@chunk_$i.bin"
done

# 3. æŸ¥è¯¢ä¸Šä¼ çŠ¶æ€
curl -X GET "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks/status?upload_token=upload_token_from_step1"

# 4. å®Œæˆæ–‡ä»¶åˆå¹¶
curl -X POST "https://your-domain.com/api/v1/rooms/myroom/uploads/chunks/complete" \
  -H "Content-Type: application/json" \
  -d '{
    "reservation_id": 12345,
    "final_hash": "sha256_hash_of_complete_file"
  }'
```

### æœ€ä½³å®è·µ

#### 1. é”™è¯¯å¤„ç†

- å§‹ç»ˆæ£€æŸ¥ HTTP çŠ¶æ€ç 
- å®ç°æŒ‡æ•°é€€é¿æœºåˆ¶å¤„ç†ä¸´æ—¶é”™è¯¯
- è®°å½•è¯¦ç»†çš„é”™è¯¯æ—¥å¿—ç”¨äºè°ƒè¯•
- å‘ç”¨æˆ·æä¾›å‹å¥½çš„é”™è¯¯æ¶ˆæ¯

#### 2. ä»¤ç‰Œç®¡ç†

- å®‰å…¨å­˜å‚¨åˆ·æ–°ä»¤ç‰Œï¼Œä½¿ç”¨ HttpOnly Cookie
- åœ¨ä»¤ç‰Œè¿‡æœŸå‰ 5 åˆ†é’Ÿå¼€å§‹åˆ·æ–°æµç¨‹
- å®ç°ä»¤ç‰Œé»‘åå•æœºåˆ¶é˜²æ­¢é‡æ”¾æ”»å‡»
- å®šæœŸæ¸…ç†è¿‡æœŸçš„ä»¤ç‰Œå’Œé¢„ç•™

#### 3. æ–‡ä»¶ä¸Šä¼ 

- å¯¹å¤§æ–‡ä»¶ä½¿ç”¨åˆ†å—ä¸Šä¼ æé«˜å¯é æ€§
- å®ç°ä¸Šä¼ è¿›åº¦è·Ÿè¸ªæä¾›ç”¨æˆ·åé¦ˆ
- éªŒè¯æ–‡ä»¶ç±»å‹å’Œå¤§å°é˜²æ­¢æ¶æ„ä¸Šä¼ 
- ä½¿ç”¨å”¯ä¸€æ–‡ä»¶åé¿å…å†²çª
- å®ç°æ–­ç‚¹ç»­ä¼ æ”¯æŒç½‘ç»œä¸­æ–­æ¢å¤

#### 4. æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨è¿æ¥æ± ä¼˜åŒ–æ•°æ®åº“è¿æ¥
- å®ç°é€‚å½“çš„ç¼“å­˜ç­–ç•¥å‡å°‘æ•°æ®åº“æŸ¥è¯¢
- å¯¹å¤§æ–‡ä»¶æ“ä½œä½¿ç”¨æµå¼å¤„ç†é¿å…å†…å­˜æº¢å‡º
- å®ç°è¯·æ±‚é™æµé˜²æ­¢æ»¥ç”¨
- ç›‘æ§ API å“åº”æ—¶é—´å’Œé”™è¯¯ç‡

#### 5. å®‰å…¨å»ºè®®

- å§‹ç»ˆä½¿ç”¨ HTTPS ä¼ è¾“
- å®ç°è¾“å…¥éªŒè¯å’Œæ¸…ç†é˜²æ­¢æ³¨å…¥æ”»å‡»
- ä½¿ç”¨å¼ºéšæœºå¯†é’¥ç”Ÿæˆ JWT ä»¤ç‰Œ
- å®ç°é€‚å½“çš„ CORS ç­–ç•¥
- å®šæœŸè½®æ¢ JWT å¯†é’¥
- è®°å½•å’Œç›‘æ§å¼‚å¸¸è®¿é—®è¡Œä¸º

## OpenAPI æ–‡æ¡£

å¯åŠ¨æœåŠ¡åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®è‡ªåŠ¨ç”Ÿæˆçš„ API æ–‡æ¡£ï¼š

- **Scalar UI**: `https://your-domain.com/api/v1/scalar`
- **OpenAPI JSON**: `https://your-domain.com/api/v1/openapi.json`

è¿™äº›æ–‡æ¡£æä¾›äº†å®Œæ•´çš„ API è§„èŒƒã€äº¤äº’å¼æµ‹è¯•ç•Œé¢å’Œä»£ç ç”ŸæˆåŠŸèƒ½ã€‚

### API ç«¯ç‚¹æ€»è§ˆ

#### æˆ¿é—´ç®¡ç†

- `POST /api/v1/rooms/{name}` - åˆ›å»ºæˆ¿é—´
- `GET /api/v1/rooms/{name}` - æŸ¥è¯¢æˆ¿é—´ä¿¡æ¯
- `DELETE /api/v1/rooms/{name}` - åˆ é™¤æˆ¿é—´

#### è®¤è¯å’Œæƒé™

- `POST /api/v1/rooms/{name}/tokens` - è·å–è®¿é—®ä»¤ç‰Œ
- `POST /api/v1/rooms/{name}/tokens/validate` - éªŒè¯ä»¤ç‰Œ
- `GET /api/v1/rooms/{name}/tokens` - è·å–ä»¤ç‰Œåˆ—è¡¨
- `DELETE /api/v1/rooms/{name}/tokens/{jti}` - æ’¤é”€ä»¤ç‰Œ
- `POST /api/v1/rooms/{name}/permissions` - æ›´æ–°æˆ¿é—´æƒé™

#### å†…å®¹ç®¡ç†

- `GET /api/v1/rooms/{name}/contents` - è·å–å†…å®¹åˆ—è¡¨
- `POST /api/v1/rooms/{name}/contents/prepare` - é¢„ç•™ä¸Šä¼ ç©ºé—´
- `POST /api/v1/rooms/{name}/contents` - ä¸Šä¼ æ–‡ä»¶
- `GET /api/v1/rooms/{name}/contents/{content_id}` - ä¸‹è½½æ–‡ä»¶
- `DELETE /api/v1/rooms/{name}/contents` - åˆ é™¤å†…å®¹

#### åˆ†å—ä¸Šä¼ 

- `POST /api/v1/rooms/{name}/uploads/chunks/prepare` - é¢„ç•™åˆ†å—ä¸Šä¼ 
- `POST /api/v1/rooms/{name}/uploads/chunks` - ä¸Šä¼ åˆ†å—
- `GET /api/v1/rooms/{name}/uploads/chunks/status` - æŸ¥è¯¢ä¸Šä¼ çŠ¶æ€
- `POST /api/v1/rooms/{name}/uploads/chunks/complete` - å®Œæˆæ–‡ä»¶åˆå¹¶

#### ç³»ç»ŸçŠ¶æ€

- `GET /api/v1/health` - å¥åº·æ£€æŸ¥
- `GET /api/v1/status` - ç³»ç»ŸçŠ¶æ€

#### è®¤è¯ç®¡ç†

- `POST /api/v1/auth/refresh` - åˆ·æ–°è®¿é—®ä»¤ç‰Œ
- `POST /api/v1/auth/logout` - ç™»å‡º
- `DELETE /api/v1/auth/cleanup` - æ¸…ç†è¿‡æœŸä»¤ç‰Œ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0 **æœ€åæ›´æ–°**: 2025-10-24 **ç»´æŠ¤å›¢é˜Ÿ**: Elizabeth å¼€å‘å›¢é˜Ÿ
